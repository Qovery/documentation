<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">
<link rel="preconnect" href="https://phprox.qovery.com">
<script>!function(t,e){var o,p,i,n;e.__SV||(window.posthog=e,e._i=[],e.init=function(r,s,c){function a(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(i=t.createElement("script")).type="text/javascript",i.async=!0,i.src=s.api_host+"/static/array.js",(n=t.getElementsByTagName("script")[0]).parentNode.insertBefore(i,n);var g=e;for(void 0!==c?g=e[c]=[]:c="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==c&&(e+="."+c),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset".split(" "),p=0;p<o.length;p++)a(g,o[p]);e._i.push([r,s,c])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_IgdG1K2GveDUte1gJ6hlwNbFHCv9nViWETUyLMU7ciq",{api_host:"https://phprox.qovery.com"})</script>
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Qovery Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Qovery Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu|Roboto|Source+Code+Pro">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css">
<script src="/js/intercom.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=UA-129773960-5" async></script>
<script src="/js/ga.js"></script>

<title data-react-helmet="true">Deploy a DaemonSet in a Karpenter context | Qovery</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Deploy a DaemonSet in a Karpenter context | Qovery"><meta data-react-helmet="true" name="msapplication-TileColor" content="#da532c"><meta data-react-helmet="true" name="theme-color" content="#ffffff"><meta data-react-helmet="true" name="description" content="Deploy a DaemonSet in a Karpenter context, in minutes, for free"><meta data-react-helmet="true" property="og:description" content="Deploy a DaemonSet in a Karpenter context, in minutes, for free"><meta data-react-helmet="true" property="og:image" content="https://hub.qovery.com/img/open-graph.png"><meta data-react-helmet="true" property="twitter:image" content="https://hub.qovery.com/img/open-graph.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Deploy a DaemonSet in a Karpenter context | Qovery"><meta data-react-helmet="true" property="og:url" content="https://docs.qovery.com/guides/advanced/deploy-daemonset-with-karpenter/"><meta data-react-helmet="true" name="twitter:card" content="summary">

<link data-react-helmet="true" rel="icon" href="/favicons/favicon.svg"><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png"><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"><link data-react-helmet="true" rel="manifest" href="/favicons/site.webmanifest"><link data-react-helmet="true" rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5"><link data-react-helmet="true" rel="canonical" href="https://docs.qovery.com/guides/advanced/deploy-daemonset-with-karpenter/">


<link rel="stylesheet" href="/styles.5dba54ed.css">


<link rel="preload" href="/styles.255c8fd1.js" as="script">

<link rel="preload" href="/runtime~main.2016b8b2.js" as="script">

<link rel="preload" href="/main.10c3ce23.js" as="script">

<link rel="preload" href="/1.385570ab.js" as="script">

<link rel="preload" href="/2.91632de6.js" as="script">

<link rel="preload" href="/3.ac200c48.js" as="script">

<link rel="preload" href="/1c13b173.a1d42003.js" as="script">

<link rel="preload" href="/766a314f.6b4fd942.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top navbarHideable_2ZIa"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/guides/tutorial">Tutorials</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://discuss.qovery.com">Forum</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://start.qovery.com">Web Console</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://www.qovery.com">Home</a><a class="navbar__item navbar__link" title="GitHub" target="_blank" rel="noopener noreferrer" href="https://github.com/Qovery"><i class="feather icon-github"></i> </a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_16CL"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_34Mc moon_313u"></span></div><div class="react-toggle-track-x"><span class="toggle_34Mc sun_1Og-"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/guides/">Guides</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" href="/guides/tutorial">Tutorials</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://discuss.qovery.com">Forum</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://start.qovery.com">Web Console</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://www.qovery.com">Home</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" title="GitHub" target="_blank" rel="noopener noreferrer" href="https://github.com/Qovery"></a></li></ul></div></div></div></nav><div class="main-wrapper"><header class="hero domain-bg domain-bg--default"><div class="container"><div class="hero--category"><a aria-current="page" class="active" href="/guides/advanced/">advanced</a></div><h1 class="header_1mJE">Deploy a DaemonSet in a Karpenter context</h1><div class="hero--subtitle">How to ensure your DaemonSet is well deployed when you are using Karpenter.</div><div class="tags_3AF9"><a class="badge badge--rounded badge--pink" href="/guides/tags/type-tutorial/">type: tutorial</a><a class="badge badge--rounded badge--primary" href="/guides/tags/technology-qovery/">technology: qovery</a><a class="badge badge--rounded badge--primary" href="/guides/tags/installation-guide-aws/">installation_guide: aws</a></div></div></header><main class="container container--l container_1ncB"><aside class="sidebar_1pU0"><section class="avatar_1sJg"><div class="avatar avatar--lg avatar--vertical"><img class="avatar__photo avatar__photo--lg" src="https://github.com/acarranoqovery.png"><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/acarranoqovery" target="_blank" rel="author">Alessandro Carrano</a></div><small class="avatar__subtitle">Alessandro is a Lead Product Manager at <a href="https://www.qovery.com">Qovery</a>.</small></div></div></section><section class="table-of-contents tableOfContents_1eMQ"><div class="section"><div class="title">Stats</div><div class="text--secondary text--bold"><i class="feather icon-book"></i> 4 min read</div><div class="text--secondary text--bold"><i class="feather icon-clock"></i> Updated <time pubdate="pubdate" datetime="2025-02-04">Feb 4th, 2025</time></div></div><div class="section"><div class="title">Contents</div><ul class="contents"><li><a href="#overview" class="contents__link">Overview</a></li><li><a href="#what-is-a-daemonset" class="contents__link">What is a DaemonSet?</a></li><li><a href="#priority-classes" class="contents__link">Priority classes</a><ul><li><a href="#what-is-a-priorityclass" class="contents__link">What is a PriorityClass?</a></li><li><a href="#use-priorityclass-built-in-helm-charts" class="contents__link">Use PriorityClass built-in Helm Charts</a></li><li><a href="#use-qoverys-dedicated-priorityclass" class="contents__link">Use Qovery&#39;s dedicated PriorityClass</a></li></ul></li><li><a href="#targeting-all-the-nodes" class="contents__link">Targeting all the nodes</a><ul><li><a href="#nodepool-default-taints" class="contents__link">Nodepool default taints</a></li><li><a href="#how-to-target-every-node" class="contents__link">How to target every node</a></li></ul></li></ul></div></section></aside><div class="article_mCV7"><article><div class="markdown"><a aria-hidden="true" tabindex="-1" class="anchor" id="overview"></a><p><a href="https://karpenter.sh/">Karpenter</a> is a great way to cut your AWS bill. It provides a simple and flexible way to scale and optimize your resource consumption. </p><p>But when it comes to deploying DaemonSets, you need to take care of some specific configurations to ensure that your DaemonSet is well deployed. This guide will show you how to deploy a DaemonSet in a Karpenter context.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="what-is-a-daemonset"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-is-a-daemonset" title="Direct link to heading">#</a>What is a DaemonSet?</h2><p>A DaemonSet in Kubernetes is a specialized controller used to ensure that a copy of a particular pod runs on all nodes in a cluster. It is particularly useful for deploying background tasks or system-level services that need to run on every node, such as log collectors, monitoring agents, or network components.</p><p>Key features of DaemonSets include:</p><ul><li>Automatic Scheduling: When nodes are added to the cluster, the DaemonSet schedules the specified pod on the new nodes automatically.</li><li>Cleanup: When nodes are removed, the DaemonSet cleans up the pods running on those nodes.</li></ul><p>This makes DaemonSets a powerful tool for maintaining uniformity and reliability in the operation of essential services across a Kubernetes cluster.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="priority-classes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#priority-classes" title="Direct link to heading">#</a>Priority classes</h2><p>There is a <a href="https://github.com/kubernetes-sigs/karpenter/issues/731">known issue</a> with Karpenter and DaemonSets when scaling nodes. DaemonSets ensure a copy of a pod runs on every node, consuming additional resources that Karpenter does not consider, leading to potential resource contention and under-provisioned nodes.</p><p>This forces operators to over-provision their nodes, resulting in inefficient resource utilization and higher costs. While the Kubernetes community and Karpenter developers are working on solutions, users currently need to manually adjust resource allocations and monitor node utilization to mitigate these issues.</p><p>A way to resolve this problem is to use a PriorityClass and attach it to the DaemonSet we are creating.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="what-is-a-priorityclass"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-is-a-priorityclass" title="Direct link to heading">#</a>What is a PriorityClass?</h3><p>A PriorityClass in Kubernetes is a resource used to assign priority levels to pods. It helps the Kubernetes scheduler make decisions during resource contention by determining which pods should be scheduled first or evicted in case of resource shortages.</p><ul><li>Pods with higher priorities are scheduled before those with lower priorities.</li><li>During resource shortages, lower-priority pods may be preempted (evicted) to free up resources for higher-priority pods.</li></ul><p>This ensures that critical workloads have the resources they need to run effectively.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="use-priorityclass-built-in-helm-charts"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-priorityclass-built-in-helm-charts" title="Direct link to heading">#</a>Use PriorityClass built-in Helm Charts</h3><p>Many Helm charts include built-in values to automatically create and configure PriorityClasses. We have examples in our documentation:</p><ul><li><a href="https://hub.qovery.com/guides/tutorial/kubernetes-observability-and-monitoring-with-datadog/">Kubernetes observability and monitoring with Datadog
</a></li><li><a href="https://hub.qovery.com/guides/tutorial/deploy-jupyterhub-qovery/">Deploy JupyterHub using Helm
</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="use-qoverys-dedicated-priorityclass"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-qoverys-dedicated-priorityclass" title="Direct link to heading">#</a>Use Qovery&#x27;s dedicated PriorityClass</h3><p>When deploying Qovery on a cluster, a dedicated PriorityClass named <code>qovery-standard-priority</code> is created automatically.
You can use this PriorityClass when deploying a new Helm chart or DaemonSet to ensure that DaemonSets deploy correctly, even during resource contention.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="targeting-all-the-nodes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#targeting-all-the-nodes" title="Direct link to heading">#</a>Targeting all the nodes</h2><p>When deploying a DaemonSet, you can use taints and affinities to control where the DaemonSet pods are scheduled. This can help you ensure that the DaemonSet pods are deployed only on nodes that are interesting for you (for monitoring, logging etc..).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="nodepool-default-taints"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#nodepool-default-taints" title="Direct link to heading">#</a>Nodepool default taints</h3><p>By default, 2 nodepools are deployed with Karpenter: <code>default</code> and <code>stable</code>. On the <code>stable</code> nodepool, a taint has been defined to ensure that only pods having a toleration with the <code>stable</code> nodepool can be scheduled on it (key <code>nodepool/stable</code>).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="how-to-target-every-node"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-to-target-every-node" title="Direct link to heading">#</a>How to target every node</h3><p>To ensure that the DaemonSet pods are scheduled on every node, you can add a toleration to the DaemonSet pods that matches any taint. You also need to add an affinity to the DaemonSet pods to ensure that they are not scheduled on Fargate nodes.</p><p>Here&#x27;s an example of how you can do this with a helm chart:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-yaml codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">tolerations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Exists</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">affinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodeAffinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">nodeSelectorTerms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eks.amazonaws.com/compute</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">type</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NotIn</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> fargate</span></div></div></pre></div></div></div></article></div></main></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col col--5 footer__col"><div class="margin-bottom--md"></div><div class="margin-bottom--md"><p>Qovery is a DevOps Automation Platform Helping 200+ Organizations To Ship Faster and Eliminate DevOps Hiring Needs.</p></div><div><a href="https://github.com/qovery" target="_blank"><i class="feather icon-github" alt="Qovery&#x27;s Github Repo"></i></a>    <a href="https://www.linkedin.com/company/qovery/" target="_blank"><i class="feather icon-rss" alt="Qovery&#x27;s Linkedin"></i></a>    <a href="https://twitter.com/qovery_" target="_blank"><i class="feather icon-twitter" alt="Qovery&#x27;s Twitter"></i></a></div></div><div class="col footer__col"><h4 class="footer__title">Resources</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs">Documentation</a></li><li class="footer__item"><a aria-current="page" class="footer__link-item active" href="/guides">Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/guides/tutorial">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/guides/engineering">Engineering</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/pricing" href="https://www.qovery.com/pricing">Pricing</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/enterprise" href="https://www.qovery.com/enterprise">Enterprise</a></li><li class="footer__item"><a class="footer__link-item" to="https://api-doc.qovery.com" href="https://api-doc.qovery.com">API</a></li><li class="footer__item"><a class="footer__link-item" to="https://github.com/Qovery" href="https://github.com/Qovery">Github</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" to="https://community.qovery.com" href="https://community.qovery.com">Forum</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/community-call" href="https://www.qovery.com/community-call">Community call</a></li><li class="footer__item"><a class="footer__link-item" to="https://shop.qovery.com" href="https://shop.qovery.com">Goodies</a></li><li class="footer__item"><a class="footer__link-item" to="https://roadmap.qovery.com" href="https://roadmap.qovery.com">Roadmap</a></li><li class="footer__item"><a class="footer__link-item" to="https://github.com/Qovery/replibyte" href="https://github.com/Qovery/replibyte">Replibyte</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/blog" href="https://www.qovery.com/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" to="https://jobs.qovery.com" href="https://jobs.qovery.com">Jobs</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/team" href="https://www.qovery.com/team">Team</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/investors" href="https://www.qovery.com/investors">Investors</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/contact" href="https://www.qovery.com/contact">Contact</a></li></ul></div></div><div class="text--center"><small>© 2025 DESIGNED BY QOVERY | PROUD SILVER MEMBER OF CNCF AND LINUX FOUNDATION | QOVERY BY BIRDSIGHT - ALL RIGHTS RESERVED</small><br></div></div></footer>
</div>

<script src="/styles.255c8fd1.js"></script>

<script src="/runtime~main.2016b8b2.js"></script>

<script src="/main.10c3ce23.js"></script>

<script src="/1.385570ab.js"></script>

<script src="/2.91632de6.js"></script>

<script src="/3.ac200c48.js"></script>

<script src="/1c13b173.a1d42003.js"></script>

<script src="/766a314f.6b4fd942.js"></script>


</body>
</html>