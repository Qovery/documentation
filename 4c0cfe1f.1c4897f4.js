(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{248:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return d})),n.d(t,"metadata",(function(){return b})),n.d(t,"rightToc",(function(){return p})),n.d(t,"default",(function(){return h}));var a=n(1),r=n(9),l=(n(0),n(446)),c=n(458),i=n(463),s=n(453),o=n(445),u=n(450),d={last_modified_on:"2024-01-11",title:"Create Demo Cluster",description:"Learn how to create a Kubernetes cluster with k3d for demo purposes"},b={id:"getting-started/install-qovery/kubernetes/create-k8s-cluster",title:"Create Demo Cluster",description:"Learn how to create a Kubernetes cluster with k3d for demo purposes",source:"@site/docs/getting-started/install-qovery/kubernetes/create-k8s-cluster.md",permalink:"/docs/getting-started/install-qovery/kubernetes/create-k8s-cluster",sidebar:"docs",previous:{title:"Configuration",permalink:"/docs/getting-started/install-qovery/kubernetes/byok-config"},next:{title:"Installing on AWS EKS",permalink:"/docs/getting-started/install-qovery/kubernetes/installation-aws"}},p=[{value:"Install and Run k3d",id:"install-and-run-k3d",children:[{value:"Configure the container registry",id:"configure-the-container-registry",children:[]},{value:"Install k3d",id:"install-k3d",children:[]},{value:"Check your cluster",id:"check-your-cluster",children:[]}]},{value:"Next Steps",id:"next-steps",children:[]}],m={rightToc:p};function h(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(l.b)("wrapper",Object(a.a)({},m,n,{components:t,mdxType:"MDXLayout"}),Object(l.b)(o.a,{type:"warning",mdxType:"Alert"},Object(l.b)("p",null,"This setup is just for demo purposes. If you want to use Qovery in production, you should use a managed Kubernetes cluster or even k3d but with a better setup. Feel free to contact us on our ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"https://discuss.qovery.com/"}),"Community forum")," if you need help.")),Object(l.b)("p",null,"This page explains how to set up a local Kubernetes cluster with ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"https://k3d.io"}),"k3d"),"."),Object(l.b)(u.a,{mdxType:"Assumptions"},Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"You have ",Object(l.b)("a",Object(a.a)({parentName:"li"},{href:"https://helm.sh"}),"helm")," installed on your machine"))),Object(l.b)("h2",{id:"install-and-run-k3d"},"Install and Run k3d"),Object(l.b)(s.a,{headingDepth:3,mdxType:"Steps"},Object(l.b)("ol",null,Object(l.b)("li",null,Object(l.b)("h3",{id:"configure-the-container-registry"},"Configure the container registry"),Object(l.b)("p",null,"Configure the container registry access as explained in ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/getting-started/install-qovery/kubernetes/requirements/#container-registry"}),"this section"),".")),Object(l.b)("li",null,Object(l.b)("h3",{id:"install-k3d"},"Install k3d"),Object(l.b)(c.a,{centered:!0,className:"rounded",defaultValue:"ecr",placeholder:"Select a Container Registry",select:!1,size:null,values:[{group:"Registry",label:"ECR",value:"ecr"},{group:"Registry",label:"GCR",value:"gcr"}],mdxType:"Tabs"},Object(l.b)(i.a,{value:"ecr",mdxType:"TabItem"},Object(l.b)("p",null,"Create the ",Object(l.b)("inlineCode",{parentName:"p"},"registry_bin")," folder and ",Object(l.b)("inlineCode",{parentName:"p"},"ecr-credential-provider")," file for the ECR Credential Provider service:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"mkdir -p registry_bin\ntouch registry_bin/ecr-credential-provider\nchmod 755 registry_bin/ecr-credential-provider\n")),Object(l.b)("p",null,"Now we can run a local Kubernetes cluster (update the path to ",Object(l.b)("inlineCode",{parentName:"p"},"config.yaml")," file, and the Kubernetes ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"https://hub.docker.com/r/rancher/k3s/tags"}),"image tag version"),"):"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'k3d cluster create --image rancher/k3s:v1.26.11-k3s2 --k3s-arg "--disable=traefik,metrics-server@server:0" \\\n-v $(pwd)/registry_bin:/var/lib/rancher/credentialprovider/bin@server:0  \\\n-v $(pwd)/config.yaml:/var/lib/rancher/credentialprovider/config.yaml@server:0\n')),Object(l.b)("p",null,"Now we need to install the ECR Credential Provider binary into the Kubernetes nodes. We will use a Kubernetes Job to do that:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: cloud-provider-repository-binary-builder\nspec:\n  backoffLimit: 0\n  template:\n    spec:\n      restartPolicy: Never\n      containers:\n      - name: ecr-credential-builder\n        image: alpine:3.18\n        command:\n          - /bin/sh\n          - -c\n          - |\n            apk add -U ca-certificates tar zstd tzdata go git\n            git clone https://github.com/kubernetes/cloud-provider-aws.git\n            cd cloud-provider-aws/cmd/ecr-credential-provider\n            CGO_ENABLED=0 go build -mod=readonly .\n            chmod 755 ecr-credential-provider\n            mkdir -p /mnt/host/var/lib/rancher/credentialprovider/bin/\n            cp ecr-credential-provider /mnt/host/var/lib/rancher/credentialprovider/bin/\n        volumeMounts:\n        - mountPath: /mnt/host\n          name: host\n      volumes:\n      - hostPath:\n          path: /\n          type: ""\n        name: host\n')),Object(l.b)("p",null,"You can now move on the Qovery Helm deployment.")),Object(l.b)(i.a,{value:"gcr",mdxType:"TabItem"},Object(l.b)("p",null,"Work in progress")))),Object(l.b)("li",null,Object(l.b)("h3",{id:"check-your-cluster"},"Check your cluster"),Object(l.b)(c.a,{centered:!0,className:"rounded",defaultValue:"ecr",placeholder:"Select a Container Registry",select:!1,size:null,values:[{group:"Registry",label:"ECR",value:"ecr"},{group:"Registry",label:"GCR",value:"gcr"}],mdxType:"Tabs"},Object(l.b)(i.a,{value:"ecr",mdxType:"TabItem"},Object(l.b)("p",null,"Run the following command to check that your cluster is ready with your ECR credentials:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"TODO\n"))),Object(l.b)(i.a,{value:"gcr",mdxType:"TabItem"},Object(l.b)("p",null,"Work in progress")))))),Object(l.b)("h2",{id:"next-steps"},"Next Steps"),Object(l.b)("p",null,"Congratulations! You have successfully created a Kubernetes cluster with k3d. You are now ready to install Qovery BYOK on your cluster. Next step: ",Object(l.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/getting-started/install-qovery/kubernetes/quickstart/#install-qovery"}),"Install Qovery BYOK")))}h.isMDXComponent=!0},445:function(e,t,n){"use strict";n(447);var a=n(0),r=n.n(a),l=n(444),c=n.n(l);n(132);t.a=function(e){var t=e.children,n=e.classNames,a=e.fill,l=e.icon,i=e.type,s=null;switch(i){case"danger":s="alert-triangle";break;case"success":s="check-circle";break;case"warning":s="alert-triangle";break;default:s="info"}return r.a.createElement("div",{className:c()(n,"alert","alert--"+i,{"alert--fill":a,"alert--icon":!1!==l}),role:"alert"},!1!==l&&r.a.createElement("i",{className:c()("feather","icon-"+(l||s))}),t)}},449:function(e,t,n){var a=n(28).f,r=Function.prototype,l=/^\s*function ([^ (]*)/;"name"in r||n(10)&&a(r,"name",{configurable:!0,get:function(){try{return(""+this).match(l)[1]}catch(e){return""}}})},450:function(e,t,n){"use strict";n(449);var a=n(0),r=n.n(a),l=n(445);t.a=function(e){var t=e.children,n=e.name;return r.a.createElement(l.a,{type:"info",fill:!0,icon:!1,rounded:!0,className:"list--icons list--icons--arrow list--tight list--indent margin-bottom--lg"},r.a.createElement("p",{class:"text--lg margin-bottom--sm",style:{marginTop:"-0.25em"}},"Before you begin, this ",n||"page"," assumes the following:"),t)}},453:function(e,t,n){"use strict";var a=n(0),r=n.n(a),l=(n(444),n(452)),c=n.n(l);n(133);t.a=function(e){var t=e.children,n=e.headingDepth,l=e.hideFeedbackQuestion,i="undefined"!=typeof window?window.location:null,s={title:"Tutorial on "+i+" failed",body:"The tutorial on:\n\n"+i+"\n\nHere's what went wrong:\n\n\x3c!-- Insert command output and details. Thank you for reporting! :) --\x3e"},o="https://github.com/qovery/documentation/issues/new?"+c.a.stringify(s),u=Object(a.useState)(null),d=u[0],b=u[1];return r.a.createElement("div",{className:"steps steps--h"+n},t,!l&&!d&&r.a.createElement("div",{className:"steps--feedback"},"How was it? Did this tutorial work?\xa0\xa0",r.a.createElement("span",{className:"button button--sm button--primary",onClick:function(){return b("yes")}},"Yes"),"\xa0\xa0",r.a.createElement("a",{href:o,target:"_blank",className:"button button--sm button--primary"},"No")),"yes"==d&&r.a.createElement("div",{className:"steps--feedback steps--feedback--success"},"Thanks! If you're enjoying Qovery please consider ",r.a.createElement("a",{href:"https://github.com/qovery/documentation/",target:"_blank"},"starring our Github repo"),"."))}},458:function(e,t,n){"use strict";var a=n(1),r=(n(464),n(459),n(52),n(29),n(22),n(21),n(0)),l=n.n(r),c=n(467),i=n(444),s=n.n(i),o=n(452),u=n.n(o),d=n(466),b=37,p=39;function m(e){var t=e.block,n=e.centered,a=e.changeSelectedValue,r=e.className,c=e.handleKeydown,i=e.style,o=e.values,u=e.selectedValue,d=e.tabRefs;return l.a.createElement("div",{className:n?"tabs--centered":null},l.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:s()("tabs",r,{"tabs--block":t}),style:i},o.map((function(e){var t=e.value,n=e.label;return l.a.createElement("li",{role:"tab",tabIndex:"0","aria-selected":u===t,className:s()("tab-item",{"tab-item--active":u===t}),key:t,ref:function(e){return d.push(e)},onKeyDown:function(e){return c(d,e.target,e)},onFocus:function(){return a(t)},onClick:function(){return a(t)}},n)}))))}function h(e){var t=e.placeholder,n=e.selectedValue,a=e.changeSelectedValue,r=e.size,i=e.values,s=i;if(s[0].group){var o=_.groupBy(s,"group");s=Object.keys(o).map((function(e){return{label:e,options:o[e]}}))}return l.a.createElement(c.a,{className:"react-select-container react-select--"+r,classNamePrefix:"react-select",options:s,isClearable:n,placeholder:t,value:i.find((function(e){return e.value==n})),onChange:function(e){return a(e?e.value:null)}})}t.a=function(e){e.block,e.centered;var t=e.children,n=e.defaultValue,c=e.groupId,i=e.label,s=e.placeholder,o=e.select,g=e.size,f=(e.style,e.values),v=e.urlKey,y=Object(d.a)(),O=y.tabGroupChoices,k=y.setTabGroupChoices,j=Object(r.useState)(n),w=j[0],N=j[1];if(null!=c){var C=O[c];null!=C&&C!==w&&N(C)}var E=function(e){N(e),null!=c&&k(c,e)},T=[],x=function(e,t,n){switch(n.keyCode){case p:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case b:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}};return Object(r.useEffect)((function(){if("undefined"!=typeof window&&window.location&&v){var e=u.a.parse(window.location.search);e[v]&&N(e[v])}}),[]),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"margin-bottom--"+(g||"md")},i&&l.a.createElement("div",{className:"margin-vert--sm"},i),f.length>1&&(o?l.a.createElement(h,Object(a.a)({changeSelectedValue:E,handleKeydown:x,placeholder:s,selectedValue:w,size:g,tabRefs:T},e)):l.a.createElement(m,Object(a.a)({changeSelectedValue:E,handleKeydown:x,selectedValue:w,tabRefs:T},e)))),r.Children.toArray(t).filter((function(e){return e.props.value===w}))[0])}},463:function(e,t,n){"use strict";var a=n(0),r=n.n(a);t.a=function(e){return r.a.createElement(r.a.Fragment,null,e.children)}}}]);