<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">
<link rel="preconnect" href="https://phprox.qovery.com">
<script>!function(t,e){var o,p,i,n;e.__SV||(window.posthog=e,e._i=[],e.init=function(r,s,c){function a(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(i=t.createElement("script")).type="text/javascript",i.async=!0,i.src=s.api_host+"/static/array.js",(n=t.getElementsByTagName("script")[0]).parentNode.insertBefore(i,n);var g=e;for(void 0!==c?g=e[c]=[]:c="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==c&&(e+="."+c),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset".split(" "),p=0;p<o.length;p++)a(g,o[p]);e._i.push([r,s,c])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_IgdG1K2GveDUte1gJ6hlwNbFHCv9nViWETUyLMU7ciq",{api_host:"https://phprox.qovery.com"})</script>
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Qovery Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Qovery Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu|Roboto|Source+Code+Pro">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css">
<script src="/js/intercom.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=UA-129773960-5" async></script>
<script src="/js/ga.js"></script>

<title data-react-helmet="true">Deploy a DaemonSet in a Karpenter context | Qovery</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Deploy a DaemonSet in a Karpenter context | Qovery"><meta data-react-helmet="true" name="msapplication-TileColor" content="#da532c"><meta data-react-helmet="true" name="theme-color" content="#ffffff"><meta data-react-helmet="true" name="description" content="Deploy a DaemonSet in a Karpenter context, in minutes, for free"><meta data-react-helmet="true" property="og:description" content="Deploy a DaemonSet in a Karpenter context, in minutes, for free"><meta data-react-helmet="true" property="og:image" content="https://hub.qovery.com/img/open-graph.png"><meta data-react-helmet="true" property="twitter:image" content="https://hub.qovery.com/img/open-graph.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Deploy a DaemonSet in a Karpenter context | Qovery"><meta data-react-helmet="true" property="og:url" content="https://docs.qovery.com/guides/advanced/deploy-daemonset-with-karpenter/"><meta data-react-helmet="true" name="twitter:card" content="summary">

<link data-react-helmet="true" rel="icon" href="/favicons/favicon.svg"><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png"><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"><link data-react-helmet="true" rel="manifest" href="/favicons/site.webmanifest"><link data-react-helmet="true" rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5"><link data-react-helmet="true" rel="canonical" href="https://docs.qovery.com/guides/advanced/deploy-daemonset-with-karpenter/">


<link rel="stylesheet" href="/styles.90c21fa3.css">


<link rel="preload" href="/styles.bf67a74c.js" as="script">

<link rel="preload" href="/runtime~main.c4b90b41.js" as="script">

<link rel="preload" href="/main.394dd298.js" as="script">

<link rel="preload" href="/1.033cef57.js" as="script">

<link rel="preload" href="/2.224b92f7.js" as="script">

<link rel="preload" href="/3.4f011061.js" as="script">

<link rel="preload" href="/1c13b173.c6093856.js" as="script">

<link rel="preload" href="/766a314f.d6d90b44.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top navbarHideable_2ZIa"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/guides/tutorial">Tutorials</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://discuss.qovery.com">Forum</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://start.qovery.com">Web Console</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://www.qovery.com">Home</a><a class="navbar__item navbar__link" title="GitHub" target="_blank" rel="noopener noreferrer" href="https://github.com/Qovery"><i class="feather icon-github"></i> </a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_16CL"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_34Mc moon_313u"></span></div><div class="react-toggle-track-x"><span class="toggle_34Mc sun_1Og-"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/guides/">Guides</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" href="/guides/tutorial">Tutorials</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://discuss.qovery.com">Forum</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://start.qovery.com">Web Console</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://www.qovery.com">Home</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" title="GitHub" target="_blank" rel="noopener noreferrer" href="https://github.com/Qovery"></a></li></ul></div></div></div></nav><div class="main-wrapper"><header class="hero domain-bg domain-bg--default"><div class="container"><div class="hero--category"><a aria-current="page" class="active" href="/guides/advanced/">advanced</a></div><h1 class="header_1mJE">Deploy a DaemonSet in a Karpenter context</h1><div class="hero--subtitle">How to ensure your DaemonSet is well deployed when you are using Karpenter.</div><div class="tags_3AF9"><a class="badge badge--rounded badge--pink" href="/guides/tags/type-tutorial/">type: tutorial</a><a class="badge badge--rounded badge--primary" href="/guides/tags/technology-qovery/">technology: qovery</a><a class="badge badge--rounded badge--primary" href="/guides/tags/installation-guide-aws/">installation_guide: aws</a></div></div></header><main class="container container--l container_1ncB"><aside class="sidebar_1pU0"><section class="avatar_1sJg"><div class="avatar avatar--lg avatar--vertical"><img class="avatar__photo avatar__photo--lg" src="https://github.com/baalooos.png"><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/baalooos" target="_blank" rel="author">Charles-Edouard Gagnaire</a></div><small class="avatar__subtitle">Charles-Edouard is Technical Account Manager at <a href="https://www.qovery.com">Qovery</a>.</small></div></div></section><section class="table-of-contents tableOfContents_1eMQ"><div class="section"><div class="title">Stats</div><div class="text--secondary text--bold"><i class="feather icon-book"></i> 3 min read</div><div class="text--secondary text--bold"><i class="feather icon-clock"></i> Updated <time pubdate="pubdate" datetime="2024-11-27">Nov 27th, 2024</time></div></div><div class="section"><div class="title">Contents</div><ul class="contents"><li><a href="#overview" class="contents__link">Overview</a></li><li><a href="#what-is-a-daemonset" class="contents__link">What is a DaemonSet?</a></li><li><a href="#what-is-the-problem" class="contents__link">What is the problem?</a></li><li><a href="#how-to-resolve-it" class="contents__link">How to resolve it?</a><ul><li><a href="#what-is-a-priority-class" class="contents__link">What is a Priority Class?</a></li><li><a href="#deploy-a-new-priority-class-using-helm" class="contents__link">Deploy a new Priority Class using Helm</a></li></ul></li><li><a href="#conclusion" class="contents__link">Conclusion</a></li></ul></div></section></aside><div class="article_mCV7"><article><div class="markdown"><a aria-hidden="true" tabindex="-1" class="anchor" id="overview"></a><p><a href="https://karpenter.sh/">Karpenter</a> is a great way to cut your AWS bill. It provides an easy and flexible way to scale and optimize your resource consumption. But there is a known <a href="https://github.com/kubernetes-sigs/karpenter/issues/731">issue</a> with capacity planning when you deploy DaemonSets. In this guide, I will present the issue and explain how to avoid it by using Priority Class.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="what-is-a-daemonset"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-is-a-daemonset" title="Direct link to heading">#</a>What is a DaemonSet?</h2><p>A DaemonSet in Kubernetes is a specialized controller used to ensure that a copy of a particular pod runs on all nodes in a cluster. It is particularly useful for deploying background tasks or system-level services that need to run on every node, such as log collectors, monitoring agents, or network components.</p><p>When nodes are added to the cluster, the DaemonSet automatically schedules the specified pod on the new nodes, ensuring consistent deployment across the entire infrastructure. Similarly, when nodes are removed, the DaemonSet takes care of cleaning up the pods that were running on those nodes.</p><p>This makes DaemonSets a powerful tool for maintaining uniformity and reliability in the operation of essential services across a Kubernetes cluster.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="what-is-the-problem"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-is-the-problem" title="Direct link to heading">#</a>What is the problem?</h2><p>There is a <a href="https://github.com/kubernetes-sigs/karpenter/issues/731">known issue</a> with Karpenter and DaemonSets when scaling nodes. DaemonSets ensure a copy of a pod runs on every node, consuming additional resources that Karpenter does not consider, leading to potential resource contention and under-provisioned nodes.</p><p>This forces operators to over-provision their nodes, resulting in inefficient resource utilization and higher costs. While the Kubernetes community and Karpenter developers are working on solutions, users currently need to manually adjust resource allocations and monitor node utilization to mitigate these issues.</p><p>A way to resolve this problem is to use a Priority Class and attach it to the DaemonSet we are creating.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="how-to-resolve-it"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-to-resolve-it" title="Direct link to heading">#</a>How to resolve it?</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="what-is-a-priority-class"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-is-a-priority-class" title="Direct link to heading">#</a>What is a Priority Class?</h3><p>A PriorityClass in Kubernetes is a resource used to assign a priority level to pods. This resource helps the scheduler make decisions during resource contention.</p><ul><li>Higher-priority pods are scheduled before lower-priority ones</li><li>In case of resource shortages, lower-priority pods may be preempted (evicted) to make room for higher-priority pods.</li></ul><p>This ensures that critical workloads receive the necessary resources to run effectively.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="deploy-a-new-priority-class-using-helm"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploy-a-new-priority-class-using-helm" title="Direct link to heading">#</a>Deploy a new Priority Class using Helm</h3><p>I created a <a href="https://github.com/Qovery/qovery-charts-examples/tree/main/karpenter-daemonset-priority-class-main">simple repository</a> you can clone to follow along.</p><p>Create the karpenter-priority-class service in the Qovery environment where you want to deploy your DaemonSet by following <a href="/docs/using-qovery/configuration/helm/">this documentation</a> and these values:</p><ul><li>General:<ul><li>Service name: <code>karpenter-priority-class</code></li><li>Source:<ul><li>Helm source: <code>Git Provider</code></li><li>Git account: <code>Public repository</code> (Change if you are not using GitHub)</li><li>Repository: <code>https://github.com/Qovery/qovery-charts-examples.git</code> (Replace by the name of your repository)</li><li>Branch: <code>main</code></li><li>Root application path: <code>/karpenter-daemonset-priority-class-main</code></li><li>Allow cluster-wide resources ✔️</li></ul></li></ul></li></ul><p>Click on Continue</p><ul><li>Values override as file:<ul><li>File source: <code>None</code></li></ul></li></ul><p>Then, you can:</p><ul><li>deploy this helm service to add the priority class on your cluster</li><li>Modify your DaemonSet configuration to use the new priority class an redeploy it</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="conclusion"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#conclusion" title="Direct link to heading">#</a>Conclusion</h2><p>Even if Karpenter is a great way of reducing your AWS bill, sometimes you will have to do some manual lifting. This issue is a good example. A single Priority Class is enough to avoid a complex resource allocation problem.</p></div></article></div></main></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col col--5 footer__col"><div class="margin-bottom--md"></div><div class="margin-bottom--md"><p>Qovery is a DevOps Automation Platform Helping 200+ Organizations To Ship Faster and Eliminate DevOps Hiring Needs.</p></div><div><a href="https://github.com/qovery" target="_blank"><i class="feather icon-github" alt="Qovery&#x27;s Github Repo"></i></a>    <a href="https://www.linkedin.com/company/qovery/" target="_blank"><i class="feather icon-rss" alt="Qovery&#x27;s Linkedin"></i></a>    <a href="https://twitter.com/qovery_" target="_blank"><i class="feather icon-twitter" alt="Qovery&#x27;s Twitter"></i></a></div></div><div class="col footer__col"><h4 class="footer__title">Resources</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs">Documentation</a></li><li class="footer__item"><a aria-current="page" class="footer__link-item active" href="/guides">Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/guides/tutorial">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/guides/engineering">Engineering</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/pricing" href="https://www.qovery.com/pricing">Pricing</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/enterprise" href="https://www.qovery.com/enterprise">Enterprise</a></li><li class="footer__item"><a class="footer__link-item" to="https://api-doc.qovery.com" href="https://api-doc.qovery.com">API</a></li><li class="footer__item"><a class="footer__link-item" to="https://github.com/Qovery" href="https://github.com/Qovery">Github</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" to="https://community.qovery.com" href="https://community.qovery.com">Forum</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/community-call" href="https://www.qovery.com/community-call">Community call</a></li><li class="footer__item"><a class="footer__link-item" to="https://shop.qovery.com" href="https://shop.qovery.com">Goodies</a></li><li class="footer__item"><a class="footer__link-item" to="https://roadmap.qovery.com" href="https://roadmap.qovery.com">Roadmap</a></li><li class="footer__item"><a class="footer__link-item" to="https://github.com/Qovery/replibyte" href="https://github.com/Qovery/replibyte">Replibyte</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/blog" href="https://www.qovery.com/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" to="https://jobs.qovery.com" href="https://jobs.qovery.com">Jobs</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/team" href="https://www.qovery.com/team">Team</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/investors" href="https://www.qovery.com/investors">Investors</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/contact" href="https://www.qovery.com/contact">Contact</a></li></ul></div></div><div class="text--center"><small>© 2025 DESIGNED BY QOVERY | PROUD SILVER MEMBER OF CNCF AND LINUX FOUNDATION | QOVERY BY BIRDSIGHT - ALL RIGHTS RESERVED</small><br></div></div></footer>
</div>

<script src="/styles.bf67a74c.js"></script>

<script src="/runtime~main.c4b90b41.js"></script>

<script src="/main.394dd298.js"></script>

<script src="/1.033cef57.js"></script>

<script src="/2.224b92f7.js"></script>

<script src="/3.4f011061.js"></script>

<script src="/1c13b173.c6093856.js"></script>

<script src="/766a314f.d6d90b44.js"></script>


</body>
</html>