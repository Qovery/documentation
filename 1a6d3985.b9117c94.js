(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{179:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return u})),n.d(t,"default",(function(){return d}));var a=n(1),o=n(9),r=(n(0),n(416)),i=n(415),l=(n(428),n(420)),c={last_modified_on:"2022-07-25",$schema:"/.meta/.schemas/guides.json",title:"Create your Staging environment from your Production environment on AWS",description:"Step-by-step guide to create your Staging environment from your Production environment on AWS",author_github:"https://github.com/evoxmusic",tags:["type: tutorial","technology: qovery"],hide_pagination:!0},s={categories:[{name:"tutorial",title:"Tutorial",description:"Additional step-by-step resources to leverage even more Qovery",permalink:"/guides/tutorial"}],coverLabel:"Create your Staging environment from your Production environment on AWS",description:"Step-by-step guide to create your Staging environment from your Production environment on AWS",permalink:"/guides/tutorial/create-your-staging-environment-from-your-production-environment-on-aws",readingTime:"4 min read",source:"@site/guides/tutorial/create-your-staging-environment-from-your-production-environment-on-aws.md",tags:[{label:"type: tutorial",permalink:"/guides/tags/type-tutorial"},{label:"technology: qovery",permalink:"/guides/tags/technology-qovery"}],title:"Create your Staging environment from your Production environment on AWS",truncated:!1,prevItem:{title:"Create a Playground Environment on AWS",permalink:"/guides/tutorial/create-a-playground-environment-on-aws"},nextItem:{title:"Creating API clients using OpenAPI Tools",permalink:"/guides/tutorial/generate-qovery-api-client"}},u=[{value:"Create a Staging cluster",id:"create-a-staging-cluster",children:[]},{value:"Create your Staging environment from your Production environment",id:"create-your-staging-environment-from-your-production-environment",children:[]},{value:"Update your Staging applications",id:"update-your-staging-applications",children:[]},{value:"Override your environment variables and secrets",id:"override-your-environment-variables-and-secrets",children:[]},{value:"Deploy your Staging environment",id:"deploy-your-staging-environment",children:[]},{value:"Wrapping up",id:"wrapping-up",children:[]}],b={rightToc:u};function d(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Let's say you have your production environment deployed, and you want to create a staging environment. You have two options:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Create a staging environment from scratch."),Object(r.b)("li",{parentName:"ol"},"Clone your production environment and create a staging environment from it.")),Object(r.b)("p",null,"This is where the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/using-qovery/configuration/environment/#clone-environment"}),"Environment Clone")," feature of Qovery is useful. No need to create a new environment, just clone your production environment and create a staging environment from it."),Object(r.b)("p",null,"In this guide, we will go through the steps to create a staging environment from your production environment. While applying the best practices by isolating the staging and production environments on two separated clusters and VPCs."),Object(r.b)("p",{align:"center"},Object(r.b)("img",{src:"/img/staging-from-production/complete_schema.jpg",alt:"Complete Production and Staging infrastructure"})),Object(r.b)(l.a,{mdxType:"Assumptions"},Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"You already have a production environment deployed with Qovery."))),Object(r.b)("div",{class:"video-container"},Object(r.b)("p",{align:"center"},Object(r.b)("iframe",{src:"https://www.loom.com/embed/5a76704a196341deb5384b2883113adf",width:"100%",height:"100%",frameborder:"0",webkitallowfullscreen:!0,mozallowfullscreen:!0,allowfullscreen:!0}))),Object(r.b)("h2",{id:"create-a-staging-cluster"},"Create a Staging cluster"),Object(r.b)("p",null,"Isolating the staging and production environments on two separate clusters and VPCs is a good practice to avoid any potential issues on your production caused by your staging. This is not a mandatory step, but it is well recommended."),Object(r.b)("p",null,"To create your staging cluster it's also recommended creating a new AWS IAM access key and secret access key in a dedicated subaccount. Then you are sure that both environment are also isolated at the AWS level:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Go to your Organization cluster settings"),Object(r.b)("li",{parentName:"ol"},'Add a cluster with a name "staging"'),Object(r.b)("li",{parentName:"ol"},"Deploy your staging cluster")),Object(r.b)("div",{class:"video-container"},Object(r.b)("p",{align:"center"},Object(r.b)("iframe",{src:"https://www.loom.com/embed/6f77172ae27f41a5a7c0e3114398b13c",width:"100%",height:"100%",frameborder:"0",webkitallowfullscreen:!0,mozallowfullscreen:!0,allowfullscreen:!0}))),Object(r.b)("h2",{id:"create-your-staging-environment-from-your-production-environment"},"Create your Staging environment from your Production environment"),Object(r.b)("p",null,"Now, to create your staging environment from your production environment, you need to:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},'Go inside your production environment and click on the "Clone" button.'),Object(r.b)("li",{parentName:"ol"},'Give a name to your staging environment (E.g "staging")'),Object(r.b)("li",{parentName:"ol"},'Set the mode to "Staging"'),Object(r.b)("li",{parentName:"ol"},'Set the cluster to "staging"'),Object(r.b)("li",{parentName:"ol"},'Click on "Create"'),Object(r.b)("li",{parentName:"ol"},"That's it!")),Object(r.b)(i.a,{type:"info",mdxType:"Alert"},Object(r.b)("p",null,"Cloning your database does not copy the data (yet). To copy your data in Staging consider using ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.replibyte.com"}),"Replibyte")," in standalone. It will be integrated in Qovery soon.")),Object(r.b)("div",{class:"video-container"},Object(r.b)("p",{align:"center"},Object(r.b)("iframe",{src:"https://www.loom.com/embed/614844644cc34211853de19dafe79343",width:"100%",height:"100%",frameborder:"0",webkitallowfullscreen:!0,mozallowfullscreen:!0,allowfullscreen:!0}))),Object(r.b)("p",null,"Your environment has been created, but it's not deployed yet. Before we will make some adjustment to change the branch of our applications."),Object(r.b)("h2",{id:"update-your-staging-applications"},"Update your Staging applications"),Object(r.b)("p",null,"Your Staging applications have the same branch as your Production applications. To update your Staging applications branch, you need to:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Go into the settings of each of your applications."),Object(r.b)("li",{parentName:"ol"},"Update the branch to your Staging branch."),Object(r.b)("li",{parentName:"ol"},'Click on "Save"')),Object(r.b)("div",{class:"video-container"},Object(r.b)("p",{align:"center"},Object(r.b)("iframe",{src:"https://www.loom.com/embed/2f4f2a22062a4840ae077285a891e573",width:"100%",height:"100%",frameborder:"0",webkitallowfullscreen:!0,mozallowfullscreen:!0,allowfullscreen:!0}))),Object(r.b)("p",null,"We are almost done, now we need to smartly change our environment variables and secrets to not use the one used in production."),Object(r.b)("h2",{id:"override-your-environment-variables-and-secrets"},"Override your environment variables and secrets"),Object(r.b)(i.a,{type:"info",mdxType:"Alert"},Object(r.b)("p",null,"Qovery makes the distinction between ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/using-qovery/configuration/environment-variable/"}),"Environment Variables")," and ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/using-qovery/configuration/environment-variable/"}),"Secrets")," even if for your app both will be used as Environment Variables. Check out ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/using-qovery/configuration/environment-variable/"}),"this documentation")," to learn more about Environment Variables and Secrets.")),Object(r.b)("p",null,"Let's say you have a production environment with the following environment variables:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"NODE_ENV=production"),Object(r.b)("li",{parentName:"ul"},"STRIPE_API_KEY=a-secret-production-key")),Object(r.b)("p",null,"You might need to keep the same keys but change the values. That's exactly what Qovery makes you do with the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/using-qovery/configuration/environment-variable/#override-environment-variable"}),"Environment Variable Override feature"),". You can keep the same keys but change the values."),Object(r.b)("div",{class:"video-container"},Object(r.b)("p",{align:"center"},Object(r.b)("iframe",{src:"https://www.loom.com/embed/3d5d37dd9a954500aa559afead5b3981",width:"100%",height:"100%",frameborder:"0",webkitallowfullscreen:!0,mozallowfullscreen:!0,allowfullscreen:!0}))),Object(r.b)("h2",{id:"deploy-your-staging-environment"},"Deploy your Staging environment"),Object(r.b)("p",null,'Finally, your Staging environment has been created and set up correctly. To deploy your Staging environment, you just need to go to your Staging environment and click on the "Deploy" button.'),Object(r.b)("div",{class:"video-container"},Object(r.b)("p",{align:"center"},Object(r.b)("iframe",{src:"https://www.loom.com/embed/04709bb4039447c699477ce01a1aa19b",width:"100%",height:"100%",frameborder:"0",webkitallowfullscreen:!0,mozallowfullscreen:!0,allowfullscreen:!0}))),Object(r.b)("h2",{id:"wrapping-up"},"Wrapping up"),Object(r.b)("p",null,"In this guide, we have covered everything you need to know to create a secure staging environment from your production. Now, you can take a look at ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/guides/tutorial/data-seeding-in-postgres/"}),"how to seed your Staging database")," (Guide for Postgres but applicable for most databases)."))}d.isMDXComponent=!0},415:function(e,t,n){"use strict";n(417);var a=n(0),o=n.n(a),r=n(414),i=n.n(r);n(132);t.a=function(e){var t=e.children,n=e.classNames,a=e.fill,r=e.icon,l=e.type,c=null;switch(l){case"danger":c="alert-triangle";break;case"success":c="check-circle";break;case"warning":c="alert-triangle";break;default:c="info"}return o.a.createElement("div",{className:i()(n,"alert","alert--"+l,{"alert--fill":a,"alert--icon":!1!==r}),role:"alert"},!1!==r&&o.a.createElement("i",{className:i()("feather","icon-"+(r||c))}),t)}},419:function(e,t,n){var a=n(28).f,o=Function.prototype,r=/^\s*function ([^ (]*)/;"name"in o||n(10)&&a(o,"name",{configurable:!0,get:function(){try{return(""+this).match(r)[1]}catch(e){return""}}})},420:function(e,t,n){"use strict";n(419);var a=n(0),o=n.n(a),r=n(415);t.a=function(e){var t=e.children,n=e.name;return o.a.createElement(r.a,{type:"info",fill:!0,icon:!1,rounded:!0,className:"list--icons list--icons--arrow list--tight list--indent margin-bottom--lg"},o.a.createElement("p",{class:"text--lg margin-bottom--sm",style:{marginTop:"-0.25em"}},"Before you begin, this ",n||"page"," assumes the following:"),t)}},428:function(e,t,n){"use strict";var a=n(1),o=(n(433),n(430),n(52),n(29),n(22),n(21),n(0)),r=n.n(o),i=n(440),l=n(414),c=n.n(l),s=n(422),u=n.n(s),b=n(439),d=37,m=39;function p(e){var t=e.block,n=e.centered,a=e.changeSelectedValue,o=e.className,i=e.handleKeydown,l=e.style,s=e.values,u=e.selectedValue,b=e.tabRefs;return r.a.createElement("div",{className:n?"tabs--centered":null},r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:c()("tabs",o,{"tabs--block":t}),style:l},s.map((function(e){var t=e.value,n=e.label;return r.a.createElement("li",{role:"tab",tabIndex:"0","aria-selected":u===t,className:c()("tab-item",{"tab-item--active":u===t}),key:t,ref:function(e){return b.push(e)},onKeyDown:function(e){return i(b,e.target,e)},onFocus:function(){return a(t)},onClick:function(){return a(t)}},n)}))))}function g(e){var t=e.placeholder,n=e.selectedValue,a=e.changeSelectedValue,o=e.size,l=e.values,c=l;if(c[0].group){var s=_.groupBy(c,"group");c=Object.keys(s).map((function(e){return{label:e,options:s[e]}}))}return r.a.createElement(i.a,{className:"react-select-container react-select--"+o,classNamePrefix:"react-select",options:c,isClearable:n,placeholder:t,value:l.find((function(e){return e.value==n})),onChange:function(e){return a(e?e.value:null)}})}t.a=function(e){e.block,e.centered;var t=e.children,n=e.defaultValue,i=e.groupId,l=e.label,c=e.placeholder,s=e.select,v=e.size,h=(e.style,e.values),y=e.urlKey,f=Object(b.a)(),w=f.tabGroupChoices,O=f.setTabGroupChoices,j=Object(o.useState)(n),k=j[0],S=j[1];if(null!=i){var N=w[i];null!=N&&N!==k&&S(N)}var C=function(e){S(e),null!=i&&O(i,e)},E=[],T=function(e,t,n){switch(n.keyCode){case m:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case d:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}};return Object(o.useEffect)((function(){if("undefined"!=typeof window&&window.location&&y){var e=u.a.parse(window.location.search);e[y]&&S(e[y])}}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"margin-bottom--"+(v||"md")},l&&r.a.createElement("div",{className:"margin-vert--sm"},l),h.length>1&&(s?r.a.createElement(g,Object(a.a)({changeSelectedValue:C,handleKeydown:T,placeholder:c,selectedValue:k,size:v,tabRefs:E},e)):r.a.createElement(p,Object(a.a)({changeSelectedValue:C,handleKeydown:T,selectedValue:k,tabRefs:E},e)))),o.Children.toArray(t).filter((function(e){return e.props.value===k}))[0])}}}]);