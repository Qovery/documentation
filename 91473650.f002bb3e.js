/*! For license information please see 91473650.f002bb3e.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{285:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return p}));var i=n(1),o=n(9),r=(n(0),n(411)),a=(n(418),n(410)),c=(n(415),{last_modified_on:"2023-06-12",title:"Application Health Checks",description:"Learn how to configure your Kubernetes health checks"}),s={id:"using-qovery/configuration/application-health-checks",title:"Application Health Checks",description:"Learn how to configure your Kubernetes health checks",source:"@site/docs/using-qovery/configuration/application-health-checks.md",permalink:"/docs/using-qovery/configuration/application-health-checks"},l=[{value:"Probes Configuration",id:"probes-configuration",children:[{value:"Type",id:"type",children:[]},{value:"Initial Delay (in seconds)",id:"initial-delay-in-seconds",children:[]},{value:"Period (in seconds)",id:"period-in-seconds",children:[]},{value:"Timeout (in seconds)",id:"timeout-in-seconds",children:[]},{value:"Success Threshold",id:"success-threshold",children:[]},{value:"Failure Threshold",id:"failure-threshold",children:[]}]},{value:"Configuiration for Long-starting application",id:"configuiration-for-long-starting-application",children:[]}],u={rightToc:l};function p(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(i.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Health checks are automatic procedures checking the status of your application, deciding if it is ready to receive traffic or if it needs to be restarted. Since Qovery relies on Kubernetes to deploy and run your application, we use the Kubernetes probes to regularly verify the status of your application during the deployment and/or running phases."),Object(r.b)("p",null,"Kubernetes allows you to configure two probes:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"Liveness probe"),": to check if the application container is alive (passing) or dead (failing). If the check fails, the dead container is restarted to attempt to heal the application. For example, liveness probes could catch a deadlock, where an application is running, but unable to make progress. Restarting a container in such a state can help to make the application more available despite bugs."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"Readiness probe"),": to check if the application container is ready to receive requests (as even alive containers can enter phases where they cannot handle incoming traffic). Kubernetes only routes traffic to the application if the check succeeds. One use of this signal is to control which Pods are used as backends for Services. When a Pod is not ready, it is removed from Service load balancers.")),Object(r.b)("p",{align:"center"},Object(r.b)("img",{src:"/img/configuration/advanced-settings/workflow.png",alt:"Kubernetes Probes Workflow"})),Object(r.b)("p",null,"During the deployment phase, the liveness and readiness probes play an important role on determining if the deployment succeeds or not. If you have both the liveness and readiness probes configured, both of them need to succeed before considering the deployment to be completed successfully. "),Object(r.b)("p",null,"Example:\nYou have a liveness probe configured on port 80 of your application. If during the deployment of your application the probes can't connect to port 80 and we reach a timeout, the deployment fails."),Object(r.b)("p",null,"Qovery allows you to manage these probes directly from within the Qovery console during the setup of your application, letting you decide their activation, configuration and check frequency."),Object(r.b)("p",null,"Probes can be configured for:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Applications"),Object(r.b)("li",{parentName:"ul"},"Cronjobs"),Object(r.b)("li",{parentName:"ul"},"Lifecycle Jobs")),Object(r.b)("h2",{id:"probes-configuration"},"Probes Configuration"),Object(r.b)("p",null,"The following configuration parameters are valid for both the Liveness and the Readiness probes."),Object(r.b)("h3",{id:"type"},"Type"),Object(r.b)("p",null,"Allows you to specify the type of probe you want to run against your application:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"NONE")," if ",Object(r.b)("inlineCode",{parentName:"li"},"NONE")," is selected, the probe is disabled and thus Kubernetes won't be able to verify the state of your application and take the right corrective actions. ")),Object(r.b)(a.a,{type:"info",mdxType:"Alert"},Object(r.b)("p",null,"We strongly advise to not disable the liveness probe.")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"HTTP probes")," are the most common probe type. You can use them if your application is a HTTP server, or if you create a lightweight HTTP server inside your application specifically to respond to such probes. When using a HTTP probe, you need to configure: "),Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"a port"),Object(r.b)("li",{parentName:"ul"},"a path\nOnce configured, Kubernetes pings a path (for example: ",Object(r.b)("inlineCode",{parentName:"li"},"/healthz "),") at a given port. If it gets a response in the 200 or 300 range, the check is passed. Otherwise, it is considered as failed and Kubernetes takes the necessary corrective actions."))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"TCP probes")," are most often used when HTTP or command probes aren't an option. When using a TCP Liveness probe, Kubernetes tries to establish a connection on the specified port. If the connection is successful, the application is considered healthy. Otherwise, it is considered dead and the container is restarted.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"gRPC probes"),"\nWhen using a gRCP Liveness probe, Kubernetes tries to establish a connection on the specified port and service. If the connection is successful, the application is considered healthy. Otherwise, it is considered dead and the container is restarted.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"EXEC probes"),"\nExec probes allow to define a command to be executed within your container. If the command execution fails, the probe is considered as failed."))),Object(r.b)("h3",{id:"initial-delay-in-seconds"},"Initial Delay (in seconds)"),Object(r.b)("p",null,"Allows you to specify an interval, in seconds, between the application container start and the first liveness check.\t"),Object(r.b)("p",null,"Allowing additional time for the application to start can be useful when boot time usually takes too long (due to long boot operations), or when the application opens the port before being ready to receive traffic on it (due to a still ongoing boot operation).\t"),Object(r.b)("h3",{id:"period-in-seconds"},"Period (in seconds)"),Object(r.b)("p",null,"Allows you to specify an interval, in seconds, between each probe.\t"),Object(r.b)("h3",{id:"timeout-in-seconds"},"Timeout (in seconds)"),Object(r.b)("p",null,"Allows you to specify the interval, in seconds, after which the probe times out.\t"),Object(r.b)("h3",{id:"success-threshold"},"Success Threshold"),Object(r.b)("p",null,"Allows you to specify how many consecutive successes are needed, as a minimum, for the probe to be considered successful after having failed previously."),Object(r.b)(a.a,{type:"info",mdxType:"Alert"},Object(r.b)("p",null,"For liveness probes, the value can only be ",Object(r.b)("inlineCode",{parentName:"p"},"1"))),Object(r.b)("h3",{id:"failure-threshold"},"Failure Threshold"),Object(r.b)("p",null,"Allows you to specify how many consecutive failures are needed, as a minimum, for the probe to be considered failed after having succeeded previously."),Object(r.b)("h2",{id:"configuiration-for-long-starting-application"},"Configuiration for Long-starting application"),Object(r.b)("p",null,"If your application has a long boot operation to run, your deployment might be marked as failed since the probe can't verify the state of your application within the specified time frame. In this case, you will find in your deployment logs a warning message ",Object(r.b)("inlineCode",{parentName:"p"},"Liveness probe failed: dial tcp xx.xx.xx.xx:xx: connect: connection refused")," , telling you that the probe is failing."),Object(r.b)("p",null,"If your application needs more time to boot, increase the ",Object(r.b)("inlineCode",{parentName:"p"},"Initial Delay in seconds")," of the probes to match the application boot time."),Object(r.b)(a.a,{type:"info",mdxType:"Alert"},Object(r.b)("p",null,"Startup probes are not yet available. ")))}p.isMDXComponent=!0},409:function(e,t,n){var i;!function(){"use strict";var n={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var r=typeof i;if("string"===r||"number"===r)e.push(i);else if(Array.isArray(i)&&i.length){var a=o.apply(null,i);a&&e.push(a)}else if("object"===r)for(var c in i)n.call(i,c)&&i[c]&&e.push(c)}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(i=function(){return o}.apply(t,[]))||(e.exports=i)}()},410:function(e,t,n){"use strict";n(412);var i=n(0),o=n.n(i),r=n(409),a=n.n(r);n(132);t.a=function(e){var t=e.children,n=e.classNames,i=e.fill,r=e.icon,c=e.type,s=null;switch(c){case"danger":s="alert-triangle";break;case"success":s="check-circle";break;case"warning":s="alert-triangle";break;default:s="info"}return o.a.createElement("div",{className:a()(n,"alert","alert--"+c,{"alert--fill":i,"alert--icon":!1!==r}),role:"alert"},!1!==r&&o.a.createElement("i",{className:a()("feather","icon-"+(r||s))}),t)}},411:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return f}));var i=n(0),o=n.n(i);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),u=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c({},t,{},e)),n},p=function(e){var t=u(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=Object(i.forwardRef)((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,a=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=u(n),d=i,f=p["".concat(a,".").concat(d)]||p[d]||b[d]||r;return n?o.a.createElement(f,c({ref:t},l,{components:n})):o.a.createElement(f,c({ref:t},l))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,a=new Array(r);a[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:i,a[1]=c;for(var l=2;l<r;l++)a[l]=n[l];return o.a.createElement.apply(null,a)}return o.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},412:function(e,t,n){var i=n(12);i(i.P,"Array",{fill:n(413)}),n(74)("fill")},413:function(e,t,n){"use strict";var i=n(27),o=n(75),r=n(26);e.exports=function(e){for(var t=i(this),n=r(t.length),a=arguments.length,c=o(a>1?arguments[1]:void 0,n),s=a>2?arguments[2]:void 0,l=void 0===s?n:o(s,n);l>c;)t[c++]=e;return t}},414:function(e,t,n){var i=n(28).f,o=Function.prototype,r=/^\s*function ([^ (]*)/;"name"in o||n(10)&&i(o,"name",{configurable:!0,get:function(){try{return(""+this).match(r)[1]}catch(e){return""}}})},415:function(e,t,n){"use strict";n(414);var i=n(0),o=n.n(i),r=n(410);t.a=function(e){var t=e.children,n=e.name;return o.a.createElement(r.a,{type:"info",fill:!0,icon:!1,rounded:!0,className:"list--icons list--icons--arrow list--tight list--indent margin-bottom--lg"},o.a.createElement("p",{class:"text--lg margin-bottom--sm",style:{marginTop:"-0.25em"}},"Before you begin, this ",n||"page"," assumes the following:"),t)}},416:function(e,t,n){"use strict";var i=n(1),o=n(0),r=n.n(o),a=n(39),c=n(419),s=n(20),l=n.n(s);t.a=function(e){var t,n=e.to,s=e.href,u=n||s,p=Object(c.a)(u),b=Object(o.useRef)(!1),d=l.a.canUseIntersectionObserver;return Object(o.useEffect)((function(){return!d&&p&&window.docusaurus.prefetch(u),function(){d&&t&&t.disconnect()}}),[u,d,p]),u&&p?r.a.createElement(a.b,Object(i.a)({},e,{onMouseEnter:function(){b.current||(window.docusaurus.preload(u),b.current=!0)},innerRef:function(e){var n,i;d&&e&&p&&(n=e,i=function(){window.docusaurus.prefetch(u)},(t=new window.IntersectionObserver((function(e){e.forEach((function(e){n===e.target&&(e.isIntersecting||e.intersectionRatio>0)&&(t.unobserve(n),t.disconnect(),i())}))}))).observe(n))},to:u})):r.a.createElement("a",Object(i.a)({},e,{href:u}))}},418:function(e,t,n){"use strict";var i=n(0),o=n.n(i),r=n(416),a=n(409),c=n.n(a);n(133);t.a=function(e){var t=e.children,n=e.className,i=e.badge,a=e.leftIcon,s=e.rightIcon,l=e.size,u=e.target,p=e.to,b=c()("jump-to","jump-to--"+l,n),d=o.a.createElement("div",{className:"jump-to--inner"},o.a.createElement("div",{className:"jump-to--inner-2"},a&&o.a.createElement("div",{className:"jump-to--left"},o.a.createElement("i",{className:"feather icon-"+a})),o.a.createElement("div",{className:"jump-to--main"},i?o.a.createElement("span",{className:"badge badge--primary badge--right"},i):"",t),o.a.createElement("div",{className:"jump-to--right"},o.a.createElement("i",{className:"feather icon-"+(s||"chevron-right")+" arrow"}))));return u?o.a.createElement("a",{href:p,target:u,className:b},d):o.a.createElement(r.a,{to:p,className:b},d)}},419:function(e,t,n){"use strict";function i(e){return!1===/^(https?:|\/\/)/.test(e)}n.d(t,"a",(function(){return i}))}}]);