<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">
<link rel="preconnect" href="https://phprox.qovery.com">
<script>!function(t,e){var o,p,i,n;e.__SV||(window.posthog=e,e._i=[],e.init=function(r,s,c){function a(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(i=t.createElement("script")).type="text/javascript",i.async=!0,i.src=s.api_host+"/static/array.js",(n=t.getElementsByTagName("script")[0]).parentNode.insertBefore(i,n);var g=e;for(void 0!==c?g=e[c]=[]:c="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==c&&(e+="."+c),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset".split(" "),p=0;p<o.length;p++)a(g,o[p]);e._i.push([r,s,c])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_IgdG1K2GveDUte1gJ6hlwNbFHCv9nViWETUyLMU7ciq",{api_host:"https://phprox.qovery.com"})</script>
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Qovery Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Qovery Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu|Roboto|Source+Code+Pro">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css">
<script src="/js/intercom.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=UA-129773960-5" async></script>
<script src="/js/ga.js"></script>

<title data-react-helmet="true">How to configure IP and header-based authorization | Qovery</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="How to configure IP and header-based authorization | Qovery"><meta data-react-helmet="true" name="msapplication-TileColor" content="#da532c"><meta data-react-helmet="true" name="theme-color" content="#ffffff"><meta data-react-helmet="true" name="description" content="How to configure IP and header-based authorization, in minutes, for free"><meta data-react-helmet="true" property="og:description" content="How to configure IP and header-based authorization, in minutes, for free"><meta data-react-helmet="true" property="og:image" content="https://hub.qovery.com/img/open-graph.png"><meta data-react-helmet="true" property="twitter:image" content="https://hub.qovery.com/img/open-graph.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for How to configure IP and header-based authorization | Qovery"><meta data-react-helmet="true" property="og:url" content="https://docs.qovery.com/guides/tutorial/how-to-setup-ip-and-header-based-authorization/"><meta data-react-helmet="true" name="twitter:card" content="summary">

<link data-react-helmet="true" rel="icon" href="/favicons/favicon.svg"><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png"><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"><link data-react-helmet="true" rel="manifest" href="/favicons/site.webmanifest"><link data-react-helmet="true" rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5"><link data-react-helmet="true" rel="canonical" href="https://docs.qovery.com/guides/tutorial/how-to-setup-ip-and-header-based-authorization/">


<link rel="stylesheet" href="/styles.90c21fa3.css">


<link rel="preload" href="/styles.255c8fd1.js" as="script">

<link rel="preload" href="/runtime~main.23d73f20.js" as="script">

<link rel="preload" href="/main.3ca1d2f8.js" as="script">

<link rel="preload" href="/1.385570ab.js" as="script">

<link rel="preload" href="/2.91632de6.js" as="script">

<link rel="preload" href="/3.ac200c48.js" as="script">

<link rel="preload" href="/1c13b173.a1d42003.js" as="script">

<link rel="preload" href="/9cbce5d5.993fc8de.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top navbarHideable_2ZIa"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/guides/tutorial">Tutorials</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://discuss.qovery.com">Forum</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://start.qovery.com">Web Console</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://www.qovery.com">Home</a><a class="navbar__item navbar__link" title="GitHub" target="_blank" rel="noopener noreferrer" href="https://github.com/Qovery"><i class="feather icon-github"></i> </a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_16CL"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_34Mc moon_313u"></span></div><div class="react-toggle-track-x"><span class="toggle_34Mc sun_1Og-"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/guides/">Guides</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" href="/docs/">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/guides/tutorial">Tutorials</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://discuss.qovery.com">Forum</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://start.qovery.com">Web Console</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://www.qovery.com">Home</a></li><li class="menu__list-item"><a class="navbar__item navbar__link" title="GitHub" target="_blank" rel="noopener noreferrer" href="https://github.com/Qovery"></a></li></ul></div></div></div></nav><div class="main-wrapper"><header class="hero domain-bg domain-bg--default"><div class="container"><div class="hero--category"><a aria-current="page" class="active" href="/guides/tutorial/">tutorial</a></div><h1 class="header_1mJE">How to configure IP and header-based authorization</h1><div class="hero--subtitle">How to configure IP and header-based authorization on Qovery.</div><div class="tags_3AF9"><a class="badge badge--rounded badge--pink" href="/guides/tags/type-tutorial/">type: tutorial</a><a class="badge badge--rounded badge--primary" href="/guides/tags/technology-qovery/">technology: qovery</a></div></div></header><main class="container container--l container_1ncB"><aside class="sidebar_1pU0"><section class="avatar_1sJg"><div class="avatar avatar--lg avatar--vertical"><img class="avatar__photo avatar__photo--lg" src="https://github.com/benjaminch.png"><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/benjaminch" target="_blank" rel="author">Benjamin Chastanier</a></div><small class="avatar__subtitle">Benjamin is a senior Backend Developer at <a href="https://www.qovery.com">Qovery</a>.</small></div></div></section><section class="table-of-contents tableOfContents_1eMQ"><div class="section"><div class="title">Stats</div><div class="text--secondary text--bold"><i class="feather icon-book"></i> 12 min read</div><div class="text--secondary text--bold"><i class="feather icon-clock"></i> Updated <time pubdate="pubdate" datetime="2025-01-12">Jan 12th, 2025</time></div></div><div class="section"><div class="title">Contents</div><ul class="contents"><li><a href="#overview" class="contents__link">Overview</a></li><li><a href="#goal" class="contents__link">Goal</a></li><li><a href="#initial-setup" class="contents__link">Initial setup</a><ul><li><a href="#configure-cluster" class="contents__link">Configure cluster</a></li></ul></li><li><a href="#configuring-ip-and-http-header-based-authorization" class="contents__link">Configuring IP and HTTP header-based authorization</a></li><li><a href="#testing-the-whitelist-rule" class="contents__link">Testing the whitelist rule</a></li><li><a href="#conclusion" class="contents__link">Conclusion</a></li></ul></div></section></aside><div class="article_mCV7"><article><div class="markdown"><a aria-hidden="true" tabindex="-1" class="anchor" id="overview"></a><div class="alert alert--warning alert--icon" role="alert"><i class="feather icon-alert-triangle"></i>Changing NGINX snippets configuration is an advanced feature and can lead to misconfiguration. Please be careful when changing these settings as it might break the whole NGINX configuration and thus make impossible to reach your services.</div><p>In this tutorial, we will walk you through configuring IP and HTTP header-based authorization on your service running on Qovery Managed Cluster.
This setup is particularly useful for multi-tenant systems, where access to different workspaces or services depends on a combination of the client&#x27;s IP address and a specific header.</p><div class="alert alert--info alert--fill" role="alert"><p class="text--lg margin-bottom--sm" style="margin-top:-0.25em">Before you begin, this guide assumes the following:</p><ul><li>Your service is running on a Qovery managed cluster.</li></ul></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="goal"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#goal" title="Direct link to heading">#</a>Goal</h2><p>This tutorial will cover how to setup IP and HTTP header-based authorization on your services by customizing Nginx configuration.</p><p>Here&#x27;s the business requirement we have for this tutorial:</p><ul><li><p>All incoming requests come with a custom HTTP header <code>X-QOVERY-SOURCE</code> representing source of the request, let&#x27;s say it can be one of the following values: <code>staging</code>, <code>production</code> or <code>development</code>.</p></li><li><p>Every Qovery source has a specific IP range:</p><ul><li><code>staging</code>: <code>10.42.0.0/16</code>, <code>10.43.0.0/16</code></li><li><code>production</code>: <code>10.44.0.0/16</code></li><li><code>development</code>: <code>92.xxx.xx.171</code> (my office IP address, I will use to test the setup)</li></ul></li><li><p>Every request coming from an address IP not in the range of the source should be rejected.</p></li><li><p>Reject any requests without the <code>X-QOVERY-SOURCE</code> header.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="initial-setup"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#initial-setup" title="Direct link to heading">#</a>Initial setup</h2><div class="steps steps--h3"><ol><li><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="configure-cluster"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configure-cluster" title="Direct link to heading">#</a>Configure cluster</h3><p>For this example, I will configure Nginx to enable <a href="https://hub.qovery.com/docs/using-qovery/configuration/cluster-advanced-settings/#nginxcontrollerenable_client_ip">nginx.controller.enable_client_ip</a> and <a href="https://hub.qovery.com/docs/using-qovery/configuration/cluster-advanced-settings/#nginxcontrollercompute_full_forwarded_for">nginx.controller.compute_full_forwarded_for</a>.
It will allow me to better illustrate the whitelist configuration.</p><p align="center"><img src="/img/nginx-configure-ip-and-header-based-authorization/cluster-advanced-settings-enable-real-ip-and-compute-full-forwarded-for.png" alt="Cluster initial setup in Qovery console"></p></li><li><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="configure-service"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configure-service" title="Direct link to heading">#</a>Configure service</h4><p>I will use a basic container service <a href="https://hub.docker.com/r/jmalloc/echo-server">echo-server</a> setup with Qovery.
This service is listening on port 80.</p><p align="center"><img src="/img/nginx-configure-ip-and-header-based-authorization/service-initial-setup-qovery-screen.png" alt="Service initial setup in Qovery console"></p><p>To start with, this service don&#x27;t have any whitelisting in place, everything will be accepted.</p></li><li><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="testing-querying-the-service"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#testing-querying-the-service" title="Direct link to heading">#</a>Testing querying the service</h4><p>Testing the service to make sure it&#x27;s working as expected.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -v -s https://p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh/</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*   Trying </span><span class="token number" style="color:#36acaa">52.47</span><span class="token plain">.212.175:443</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Connected to p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">52.47</span><span class="token plain">.212.175</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> port </span><span class="token number" style="color:#36acaa">443</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* ALPN: </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> offers h2,http/1.1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OUT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Client hello </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  CAfile: /etc/ssl/cert.pem</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  CApath: none</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Server hello </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Unknown </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Certificate </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, CERT verify </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Finished </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OUT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Finished </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* SSL connection using TLSv1.3 / AEAD-AES256-GCM-SHA384</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* ALPN: server accepted h2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Server certificate:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  subject: </span><span class="token assign-left variable" style="color:#36acaa">CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">*.z77ccfcb8.slab.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  start date: Dec </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> 08:35:19 </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain"> GMT</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  expire date: Mar </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> 08:35:18 </span><span class="token number" style="color:#36acaa">2025</span><span class="token plain"> GMT</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  subjectAltName: </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh&quot;</span><span class="token plain"> matched cert</span><span class="token string" style="color:#e3116c">&#x27;s &quot;*.z77ccfcb8.sl</span></div><div class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">*  issuer: C=US; O=Let&#x27;</span><span class="token plain">s Encrypt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">R11</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  SSL certificate verify ok.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* using HTTP/2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> OPENED stream </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> https://p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh/</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:method: GET</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:scheme: https</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:authority: p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:path: /</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">user-agent: curl/8.4.0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">accept: */*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> GET / HTTP/2</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Host: p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> User-Agent: curl/8.4.0</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Accept: */*</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> HTTP/2 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> date: Sun, </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"> Jan </span><span class="token number" style="color:#36acaa">2025</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:31:07 GMT</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> content-type: text/plain</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> content-length: </span><span class="token number" style="color:#36acaa">429</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> strict-transport-security: max-age</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">31536000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> includeSubDomains</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">Request served by app-zc6971a47-service-example-66b74b556d-l4kk6</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">GET / HTTP/1.1</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Host: p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Accept: */*</span></div><div class="token-line" style="color:#393A34"><span class="token plain">User-Agent: curl/8.4.0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-For: </span><span class="token number" style="color:#36acaa">92</span><span class="token plain">.xxx.xx.171</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-Host: p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-Port: </span><span class="token number" style="color:#36acaa">443</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-Proto: https</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-Scheme: https</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Real-Ip: </span><span class="token number" style="color:#36acaa">92</span><span class="token plain">.xxx.xx.171</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Request-Id: 9e0119afcd2fcbb1b45ac1131ba82a15</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Scheme: https</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Connection </span><span class="token comment" style="color:#999988;font-style:italic">#0 to host p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh left intact</span></div></div></pre></div></div><p>All good!</p></li></ol><div class="steps--feedback">How was it? Did this tutorial work?  <span class="button button--sm button--primary">Yes</span>  <a href="https://github.com/qovery/documentation/issues/new?body=The%20tutorial%20on%3A%0A%0Anull%0A%0AHere%27s%20what%20went%20wrong%3A%0A%0A%3C%21--%20Insert%20command%20output%20and%20details.%20Thank%20you%20for%20reporting%21%20%3A%29%20--%3E&amp;title=Tutorial%20on%20null%20failed" target="_blank" class="button button--sm button--primary">No</a></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="configuring-ip-and-http-header-based-authorization"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuring-ip-and-http-header-based-authorization" title="Direct link to heading">#</a>Configuring IP and HTTP header-based authorization</h2><div class="steps steps--h3"><ol><li><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="declare-whitelisting-configuration-at-cluster-level"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#declare-whitelisting-configuration-at-cluster-level" title="Direct link to heading">#</a>Declare whitelisting configuration at cluster level</h4><p>In order to set a whitelisting configuration, we need to declare it at cluster level in cluster advanced settings <code>nginx.controller.http_snippet</code> (see <a href="https://hub.qovery.com/docs/using-qovery/configuration/cluster-advanced-settings/#nginxcontrollerhttp_snippet">documentation</a>).</p><p>Here&#x27;s nginx <code>nginx.controller.http_snippet</code> value we will set:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-nginx codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># Whitelisting</span></div><div class="token-line" style="color:#393A34"><span class="token plain">geo $production {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  default 0;      # 0 as default value for unmatched IPs</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  10.44.0.0/16 1; # 1 if source IP is within the range</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">geo $staging {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  default 0;      # 0 as default value for unmatched IPs</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  10.42.0.0/16 1; # 1 if source IP is within the range</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  10.43.0.0/16 1; # 1 if source IP is within the range</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">geo $development {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  default 0;          # 0 as default value for unmatched IPs</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  92.xxx.xx.171/32 1; # 1 if source IP is this exact IP (some values were replaced by x for privacy)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">map $http_x_qovery_source $is_authorized_source {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  default 0;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  &quot;production&quot; $production;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  &quot;staging&quot; $staging;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  &quot;development&quot; $development;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></pre></div></div><strong>Details</strong><ul><li>The <code>geo</code> directive creates variables based on the client&#x27;s IP address, allowing you to classify them into groups. In this case, the <code>geo</code> blocks define access for production and staging environments.<ul><li><code>geo $production</code>: creates a variable $production to determine if the client IP is part of the allowed range.<ul><li><code>default 0;</code>: default value is <code>0</code>, meaning any IP that does not match explicitly will be denied.</li><li><code>10.44.0.0/16 1</code>: <code>10.44.0.0/16</code> range is assigned the value <code>1</code>, meaning it&#x27;s allowed.</li></ul></li><li><code>geo $staging</code>: creates a variable $staging.<ul><li><code>default 0;</code>: default value is <code>0</code>, meaning any IP that does not match explicitly will be denied.</li><li><code>10.43.0.0/16 1</code>: <code>10.43.0.0/16</code> range is assigned the value <code>1</code>, meaning it&#x27;s allowed.</li><li><code>10.42.0.0/16 1</code>: <code>10.42.0.0/16</code> range is assigned the value <code>1</code>, meaning it&#x27;s allowed.</li></ul></li><li><code>geo $development</code>: creates a variable $development to determine if the client IP is part of the allowed range.<ul><li><code>default 0;</code>: default value is <code>0</code>, meaning any IP that does not match explicitly will be denied.</li><li><code>92.xxx.xx.171/32 1</code>: <code>92.xxx.xx.171/32</code> IP is assigned the value <code>1</code>, meaning it&#x27;s allowed.</li></ul></li></ul></li><li>The <code>map</code> directive is used to derive a new variable (<code>$is_authorized_source</code>) based on the value of another variable (<code>$http_x_qovery_source</code>).<ul><li><code>map $http_x_qovery_source $is_authorized_source</code>: the value of the <code>X-Qovery-Source</code> HTTP header (<code>$http_x_qovery_source</code>) determines the <code>$is_authorized_source</code> variable.<ul><li><code>default 0;</code>: if the <code>X-Qovery-Source</code> header does not match any specified key, <code>$is_authorized_source</code> is set to <code>0</code>.</li><li><code>&quot;production&quot; $production</code>: if <code>X-Qovery-Source</code> is <code>&quot;production&quot;</code>, the <code>$is_authorized_source</code> will take the value of <code>$production</code> (either <code>0</code> or <code>1</code>, depending on the client&#x27;s IP range).</li><li><code>&quot;staging&quot; $staging</code>: similarly, if <code>X-Qovery-Source</code> is <code>&quot;staging&quot;</code>, <code>$is_authorized_source</code> will take the value of <code>$staging</code></li><li><code>&quot;development&quot; $development</code>: similarly, if <code>X-Qovery-Source</code> is <code>&quot;development&quot;</code>, <code>$is_authorized_source</code> will take the value of <code>$development</code></li></ul></li></ul></li></ul><p align="center"><img src="/img/nginx-configure-ip-and-header-based-authorization/cluster-advanced-settings-set-http-snippet-with-whitelisting-rule.png" alt="Declare whitelisting rule in cluster advanced settings"></p></li><li><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="use-this-whitelisting-rule-in-cluster-configuration"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-this-whitelisting-rule-in-cluster-configuration" title="Direct link to heading">#</a>Use this whitelisting rule in cluster configuration</h4><p>Now that our whitelisting rule is defined, let use it in our cluster configuration.</p><p>In order to do so, we need to declare this server snippet at cluster level in advanced settings <code>nginx.controller.server_snippet</code> (see <a href="https://hub.qovery.com/docs/using-qovery/configuration/cluster-advanced-settings/#nginxcontrollerserver_snippet">documentation</a>):</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-nginx codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">add_header X-debug-source $http_x_qovery_source always;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">add_header X-debug-ip $remote_addr always;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">add_header X-debug-is-authorized $is_authorized_source always;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">if ($is_authorized_source = 0) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  return 403;  # Forbidden</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></pre></div></div><strong> Details </strong><p>This snippet will return an HTTP <code>403</code> for any request that does not match the whitelisting rule we defined earlier.
In order to ease setup and debug, I&#x27;ve added some headers to the response:</p><ul><li><code>X-debug-source</code>: the value of the <code>X-Qovery-Source</code> header.</li><li><code>X-debug-ip</code>: the client&#x27;s IP address.</li><li><code>X-debug-is-authorized</code>: whether the request is authorized or not.</li></ul><p align="center"><img src="/img/nginx-configure-ip-and-header-based-authorization/cluster-advanced-settings-whitelisting-in-server-snippet.png" alt="Declare service whitelisting rule in advanced settings"></p></li><li><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="deploy-your-cluster"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploy-your-cluster" title="Direct link to heading">#</a>Deploy your cluster</h4><p>You can now deploy your cluster with the new settings.</p><p align="center"><img src="/img/nginx-configure-ip-and-header-based-authorization/deploy-cluster-after-advanced-settings-changes.png" alt="Deploy cluster after advanced settings changes"></p></li></ol><div class="steps--feedback">How was it? Did this tutorial work?  <span class="button button--sm button--primary">Yes</span>  <a href="https://github.com/qovery/documentation/issues/new?body=The%20tutorial%20on%3A%0A%0Anull%0A%0AHere%27s%20what%20went%20wrong%3A%0A%0A%3C%21--%20Insert%20command%20output%20and%20details.%20Thank%20you%20for%20reporting%21%20%3A%29%20--%3E&amp;title=Tutorial%20on%20null%20failed" target="_blank" class="button button--sm button--primary">No</a></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="testing-the-whitelist-rule"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#testing-the-whitelist-rule" title="Direct link to heading">#</a>Testing the whitelist rule</h2><p>Let&#x27;s test our setup</p><div class="steps steps--h3"><ol><li><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="case-1-no-header-ip-outside-any-whitelisted-ranges"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-1-no-header-ip-outside-any-whitelisted-ranges" title="Direct link to heading">#</a>Case 1: No header, IP outside any whitelisted ranges</h4><p>For this test, I will send a request without the <code>X-QOVERY-SOURCE</code> header and from an IP address outside the allowed ranges.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -v -s https://p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh/</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*   Trying </span><span class="token number" style="color:#36acaa">13.38</span><span class="token plain">.142.29:443</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Connected to p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">13.38</span><span class="token plain">.142.29</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> port </span><span class="token number" style="color:#36acaa">443</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* ALPN: </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> offers h2,http/1.1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OUT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Client hello </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  CAfile: /etc/ssl/cert.pem</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  CApath: none</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Server hello </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Unknown </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Certificate </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, CERT verify </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Finished </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OUT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Finished </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* SSL connection using TLSv1.3 / AEAD-AES256-GCM-SHA384</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* ALPN: server accepted h2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Server certificate:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  subject: </span><span class="token assign-left variable" style="color:#36acaa">CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">*.z77ccfcb8.slab.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  start date: Dec </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> 08:35:19 </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain"> GMT</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  expire date: Mar </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> 08:35:18 </span><span class="token number" style="color:#36acaa">2025</span><span class="token plain"> GMT</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  subjectAltName: </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh&quot;</span><span class="token plain"> matched cert</span><span class="token string" style="color:#e3116c">&#x27;s &quot;*.z77ccfcb8.slab.sh&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">*  issuer: C=US; O=Let&#x27;</span><span class="token plain">s Encrypt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">R11</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  SSL certificate verify ok.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* using HTTP/2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> OPENED stream </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> https://p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh/</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:method: GET</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:scheme: https</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:authority: p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:path: /</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">user-agent: curl/8.4.0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">accept: */*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> GET / HTTP/2</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Host: p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> User-Agent: curl/8.4.0</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Accept: */*</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> HTTP/2 </span><span class="token number" style="color:#36acaa">403</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> date: Sun, </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"> Jan </span><span class="token number" style="color:#36acaa">2025</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:49:20 GMT</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> content-type: text/html</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> content-length: </span><span class="token number" style="color:#36acaa">146</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> x-debug-ip: </span><span class="token number" style="color:#36acaa">45.84</span><span class="token plain">.136.102</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> x-debug-is-authorized: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">html</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">head</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">title</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">403</span><span class="token plain"> Forbidden</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/title</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/head</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">body</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">center</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:#393A34">1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">403</span><span class="token plain"> Forbidden</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/h</span><span class="token operator file-descriptor important" style="color:#393A34">1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/center</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">hr</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">center</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">nginx</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/center</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/body</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/html</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Connection </span><span class="token comment" style="color:#999988;font-style:italic">#0 to host p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh left intact</span></div></div></pre></div></div><p>As we can see I&#x27;ve got an HTTP <code>403</code> status code, meaning the request was rejected.</p><p>Debug headers values:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-undefined codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">&lt; x-debug-ip: 45.84.136.102</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&lt; x-debug-is-authorized: 0</span></div></div></pre></div></div><p>NGINX controller logs showing the request was rejected.</p><p align="center"><img src="/img/nginx-configure-ip-and-header-based-authorization/nginx-logs-403-no-header-ip-outside-whitelist.png" alt="NGINX logs showing requests rejections for request without header and ip address outside whitelisted ranges"></p></li><li><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="case-2-header-production-ip-outside-any-whitelisted-ranges"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-2-header-production-ip-outside-any-whitelisted-ranges" title="Direct link to heading">#</a>Case 2: Header <code>production</code>, IP outside any whitelisted ranges</h4><p>For this test, I will send a request with the <code>X-QOVERY-SOURCE: production</code> header and from an IP address outside the allowed ranges.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -v -H </span><span class="token string" style="color:#e3116c">&#x27;X-QOVERY-SOURCE: production&#x27;</span><span class="token plain"> -s https://p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh/</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*   Trying </span><span class="token number" style="color:#36acaa">13.38</span><span class="token plain">.142.29:443</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Connected to p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">13.38</span><span class="token plain">.142.29</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> port </span><span class="token number" style="color:#36acaa">443</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* ALPN: </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> offers h2,http/1.1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OUT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Client hello </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  CAfile: /etc/ssl/cert.pem</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  CApath: none</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Server hello </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Unknown </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Certificate </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, CERT verify </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Finished </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OUT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Finished </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* SSL connection using TLSv1.3 / AEAD-AES256-GCM-SHA384</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* ALPN: server accepted h2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Server certificate:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  subject: </span><span class="token assign-left variable" style="color:#36acaa">CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">*.z77ccfcb8.slab.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  start date: Dec </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> 08:35:19 </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain"> GMT</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  expire date: Mar </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> 08:35:18 </span><span class="token number" style="color:#36acaa">2025</span><span class="token plain"> GMT</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  subjectAltName: </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh&quot;</span><span class="token plain"> matched cert</span><span class="token string" style="color:#e3116c">&#x27;s &quot;*.z77ccfcb8.slab.sh&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">*  issuer: C=US; O=Let&#x27;</span><span class="token plain">s Encrypt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">R11</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  SSL certificate verify ok.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* using HTTP/2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> OPENED stream </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> https://p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh/</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:method: GET</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:scheme: https</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:authority: p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:path: /</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">user-agent: curl/8.4.0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">accept: */*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x-qovery-source: production</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> GET / HTTP/2</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Host: p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> User-Agent: curl/8.4.0</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Accept: */*</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> X-QOVERY-SOURCE: production</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> HTTP/2 </span><span class="token number" style="color:#36acaa">403</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> date: Sun, </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"> Jan </span><span class="token number" style="color:#36acaa">2025</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:59:54 GMT</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> content-type: text/html</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> content-length: </span><span class="token number" style="color:#36acaa">146</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> x-debug-source: production</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> x-debug-ip: </span><span class="token number" style="color:#36acaa">45.84</span><span class="token plain">.136.102</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> x-debug-is-authorized: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">html</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">head</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">title</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">403</span><span class="token plain"> Forbidden</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/title</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/head</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">body</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">center</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:#393A34">1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">403</span><span class="token plain"> Forbidden</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/h</span><span class="token operator file-descriptor important" style="color:#393A34">1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/center</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">hr</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">center</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">nginx</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/center</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/body</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/html</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Connection </span><span class="token comment" style="color:#999988;font-style:italic">#0 to host p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh left intact</span></div></div></pre></div></div><p>As we can see I&#x27;ve got an HTTP <code>403</code> status code, meaning the request was rejected.</p><p>Debug headers values:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-undefined codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">&lt; x-debug-source: production</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&lt; x-debug-ip: 45.84.136.102</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&lt; x-debug-is-authorized: 0</span></div></div></pre></div></div><p>NGINX controller logs showing the request was rejected.</p><p align="center"><img src="/img/nginx-configure-ip-and-header-based-authorization/nginx-logs-403-header-production-ip-outside-whitelist.png" alt="NGINX logs showing requests rejections for request with header production and ip address outside whitelisted ranges"></p></li><li><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="case-3-header-development-ip-inside-whitelisted-ranges"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#case-3-header-development-ip-inside-whitelisted-ranges" title="Direct link to heading">#</a>Case 3: Header <code>development</code>, IP inside whitelisted ranges</h4><p>For this test, I will send a request with the <code>X-QOVERY-SOURCE: development</code> header and from an IP address inside the allowed ranges.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">documentation main* ≡2h3m18s</span></div><div class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -v -H </span><span class="token string" style="color:#e3116c">&#x27;X-QOVERY-SOURCE: development&#x27;</span><span class="token plain"> -s https://p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh/</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*   Trying </span><span class="token number" style="color:#36acaa">13.38</span><span class="token plain">.142.29:443</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Connected to p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">13.38</span><span class="token plain">.142.29</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> port </span><span class="token number" style="color:#36acaa">443</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* ALPN: </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> offers h2,http/1.1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OUT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Client hello </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  CAfile: /etc/ssl/cert.pem</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  CApath: none</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Server hello </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Unknown </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Certificate </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, CERT verify </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Finished </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">304</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OUT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, TLS handshake, Finished </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* SSL connection using TLSv1.3 / AEAD-AES256-GCM-SHA384</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* ALPN: server accepted h2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Server certificate:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  subject: </span><span class="token assign-left variable" style="color:#36acaa">CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">*.z77ccfcb8.slab.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  start date: Dec </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> 08:35:19 </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain"> GMT</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  expire date: Mar </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> 08:35:18 </span><span class="token number" style="color:#36acaa">2025</span><span class="token plain"> GMT</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  subjectAltName: </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh&quot;</span><span class="token plain"> matched cert</span><span class="token string" style="color:#e3116c">&#x27;s &quot;*.z77ccfcb8.sl</span></div><div class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">*  issuer: C=US; O=Let&#x27;</span><span class="token plain">s Encrypt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">CN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">R11</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*  SSL certificate verify ok.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* using HTTP/2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> OPENED stream </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> https://p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh/</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:method: GET</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:scheme: https</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:authority: p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">:path: /</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">user-agent: curl/8.4.0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">accept: */*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">* </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HTTP/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x-qovery-source: development</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> GET / HTTP/2</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Host: p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> User-Agent: curl/8.4.0</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Accept: */*</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> X-QOVERY-SOURCE: development</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> HTTP/2 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> date: Sun, </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"> Jan </span><span class="token number" style="color:#36acaa">2025</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">:05:32 GMT</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> content-type: text/plain</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> content-length: </span><span class="token number" style="color:#36acaa">458</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> strict-transport-security: max-age</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">31536000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> includeSubDomains</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> x-debug-source: development</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> x-debug-ip: </span><span class="token number" style="color:#36acaa">92</span><span class="token plain">.xxx.xx.171</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> x-debug-is-authorized: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">Request served by app-zc6971a47-service-example-66b74b556d-l4kk6</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">GET / HTTP/1.1</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Host: p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Accept: */*</span></div><div class="token-line" style="color:#393A34"><span class="token plain">User-Agent: curl/8.4.0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-For: </span><span class="token number" style="color:#36acaa">92</span><span class="token plain">.xxx.xx.171</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-Host: p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-Port: </span><span class="token number" style="color:#36acaa">443</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-Proto: https</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Forwarded-Scheme: https</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Qovery-Source: development</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Real-Ip: </span><span class="token number" style="color:#36acaa">92</span><span class="token plain">.xxx.xx.171</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Request-Id: ce6b9567bac12b64a5b161dc8df3d0f9</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X-Scheme: https</span></div><div class="token-line" style="color:#393A34"><span class="token plain">* Connection </span><span class="token comment" style="color:#999988;font-style:italic">#0 to host p8080-zdb6be5b9-z928629ac-gtw.z77ccfcb8.slab.sh left intact</span></div></div></pre></div></div><p>As we can see I&#x27;ve got an HTTP <code>403</code> status code, meaning the request was rejected.</p><p>Debug headers values:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><pre class="prism-code language-undefined codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">&lt; x-debug-source: development</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&lt; x-debug-ip: 92.xxx.xx.171</span></div><div class="token-line" style="color:#393A34"><span class="token plain">&lt; x-debug-is-authorized: 1</span></div></div></pre></div></div></li></ol><div class="steps--feedback">How was it? Did this tutorial work?  <span class="button button--sm button--primary">Yes</span>  <a href="https://github.com/qovery/documentation/issues/new?body=The%20tutorial%20on%3A%0A%0Anull%0A%0AHere%27s%20what%20went%20wrong%3A%0A%0A%3C%21--%20Insert%20command%20output%20and%20details.%20Thank%20you%20for%20reporting%21%20%3A%29%20--%3E&amp;title=Tutorial%20on%20null%20failed" target="_blank" class="button button--sm button--primary">No</a></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="conclusion"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#conclusion" title="Direct link to heading">#</a>Conclusion</h2><p>With the <code>nginx.controller.http_snippet</code> and <code>nginx.controller.server_snippet</code> cluster advanced settings, you can create powerful access control rules in NGINX that combine IP-based restrictions and HTTP header validation. This configuration is scalable and flexible for managing multi-tenant systems or any environment requiring complex authorization logic.</p><p>Feel free to adapt this setup to your specific needs, and always test thoroughly before deploying to production!</p></div></article></div></main></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col col--5 footer__col"><div class="margin-bottom--md"></div><div class="margin-bottom--md"><p>Qovery is a DevOps Automation Platform Helping 200+ Organizations To Ship Faster and Eliminate DevOps Hiring Needs.</p></div><div><a href="https://github.com/qovery" target="_blank"><i class="feather icon-github" alt="Qovery&#x27;s Github Repo"></i></a>    <a href="https://www.linkedin.com/company/qovery/" target="_blank"><i class="feather icon-rss" alt="Qovery&#x27;s Linkedin"></i></a>    <a href="https://twitter.com/qovery_" target="_blank"><i class="feather icon-twitter" alt="Qovery&#x27;s Twitter"></i></a></div></div><div class="col footer__col"><h4 class="footer__title">Resources</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs">Documentation</a></li><li class="footer__item"><a aria-current="page" class="footer__link-item active" href="/guides">Guides</a></li><li class="footer__item"><a aria-current="page" class="footer__link-item active" href="/guides/tutorial">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/guides/engineering">Engineering</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/pricing" href="https://www.qovery.com/pricing">Pricing</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/enterprise" href="https://www.qovery.com/enterprise">Enterprise</a></li><li class="footer__item"><a class="footer__link-item" to="https://api-doc.qovery.com" href="https://api-doc.qovery.com">API</a></li><li class="footer__item"><a class="footer__link-item" to="https://github.com/Qovery" href="https://github.com/Qovery">Github</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" to="https://community.qovery.com" href="https://community.qovery.com">Forum</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/community-call" href="https://www.qovery.com/community-call">Community call</a></li><li class="footer__item"><a class="footer__link-item" to="https://shop.qovery.com" href="https://shop.qovery.com">Goodies</a></li><li class="footer__item"><a class="footer__link-item" to="https://roadmap.qovery.com" href="https://roadmap.qovery.com">Roadmap</a></li><li class="footer__item"><a class="footer__link-item" to="https://github.com/Qovery/replibyte" href="https://github.com/Qovery/replibyte">Replibyte</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/blog" href="https://www.qovery.com/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" to="https://jobs.qovery.com" href="https://jobs.qovery.com">Jobs</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/team" href="https://www.qovery.com/team">Team</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/investors" href="https://www.qovery.com/investors">Investors</a></li><li class="footer__item"><a class="footer__link-item" to="https://www.qovery.com/contact" href="https://www.qovery.com/contact">Contact</a></li></ul></div></div><div class="text--center"><small>© 2025 DESIGNED BY QOVERY | PROUD SILVER MEMBER OF CNCF AND LINUX FOUNDATION | QOVERY BY BIRDSIGHT - ALL RIGHTS RESERVED</small><br></div></div></footer>
</div>

<script src="/styles.255c8fd1.js"></script>

<script src="/runtime~main.23d73f20.js"></script>

<script src="/main.3ca1d2f8.js"></script>

<script src="/1.385570ab.js"></script>

<script src="/2.91632de6.js"></script>

<script src="/3.ac200c48.js"></script>

<script src="/1c13b173.a1d42003.js"></script>

<script src="/9cbce5d5.993fc8de.js"></script>


</body>
</html>