/*! For license information please see e1becc8e.58f3115f.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[289],{441:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return b}));var a=n(1),r=n(9),o=(n(0),n(477)),i=(n(485),n(476)),l=(n(481),{last_modified_on:"2025-03-12",$schema:"/.meta/.schemas/guides.json",title:"Integrate your application logs to Cloudwatch",description:"Add Kubernetes pod logs into Cloudwatch to perform full text search",author_github:"https://github.com/deimosfr",tags:["type: tutorial","technology: qovery"],hide_pagination:!0}),c={categories:[{name:"tutorial",title:"Tutorial",description:"Additional step-by-step resources to leverage even more Qovery",permalink:"/guides/tutorial"}],coverLabel:"Integrate your application logs to Cloudwatch",description:"Add Kubernetes pod logs into Cloudwatch to perform full text search",permalink:"/guides/tutorial/cloudwatch-integration",readingTime:"5 min read",source:"@site/guides/tutorial/cloudwatch-integration.md",tags:[{label:"type: tutorial",permalink:"/guides/tags/type-tutorial"},{label:"technology: qovery",permalink:"/guides/tags/technology-qovery"}],title:"Integrate your application logs to Cloudwatch",truncated:!1,prevItem:{title:"Import your environment variables with the Qovery CLI",permalink:"/guides/tutorial/import-your-environment-variables-with-the-qovery-cli"},nextItem:{title:"Kubernetes observability and monitoring with Datadog",permalink:"/guides/tutorial/kubernetes-observability-and-monitoring-with-datadog"}},s=[{value:"AWS permissions for Cloudwatch",id:"aws-permissions-for-cloudwatch",children:[]},{value:"Helm",id:"helm",children:[{value:"Add the AWS EKS helm repository",id:"add-the-aws-eks-helm-repository",children:[]},{value:"Create and deploy the helm chart within Qovery",id:"create-and-deploy-the-helm-chart-within-qovery",children:[]},{value:"Store the AWS Secrets as Qovery secrets",id:"store-the-aws-secrets-as-qovery-secrets",children:[]},{value:"Deploy your chart",id:"deploy-your-chart",children:[]}]},{value:"Cloudwatch usage",id:"cloudwatch-usage",children:[]}],u={rightToc:s};function b(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Qovery provides by default an easy way to get access to your logs through the Console or the CLI. For statistics, debugging or security reasons, you may want to access all logs and perform a full-text search inside them."),Object(o.b)("p",null,"Qovery implementation is based on ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://grafana.com/oss/loki/"}),"Loki")," for performance and cost-effective reasons. However, Loki is not a full-text search engine. It is a log aggregation system. It is not designed to be queried directly."),Object(o.b)(i.a,{type:"info",mdxType:"Alert"},Object(o.b)("p",null,"Why Qovery does not provides current Loki access?"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"As mentioned Loki is not a full-text search and results may not reflect what you are looking for."),Object(o.b)("li",{parentName:"ol"},"Loki is configured to answer usage from Qovery Console and CLI. Using it directly may impact Qovery Console and CLI performances or worst, lose logs and make it irresponsive."))),Object(o.b)("p",null,"Serveral solutions exists, with and without 3rd parties. We will cover here a solution without a third party. But if you're interrested, you can take a look at ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/guides/tutorial/kubernetes-observability-and-monitoring-with-datadog/"}),"Datadog integration"),"."),Object(o.b)("p",null,"Note: in this tutorial, we are using Fluent-bit with proposed solutions above. However, if none of those solutions suits your needs, feel free to look at supported solution on the official website."),Object(o.b)("h2",{id:"aws-permissions-for-cloudwatch"},"AWS permissions for Cloudwatch"),Object(o.b)("p",null,"We will create a dedicated service account (note: STS account can be used, but for simplicity reasons, we will use a dedicated service account)."),Object(o.b)("p",null,"On IAM create a policy with the following permissions, and name this policy ",Object(o.b)("inlineCode",{parentName:"p"},"fluent-bit-write-policy"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Sid": "CloudWatchLogs",\n            "Effect": "Allow",\n            "Action": [\n                "logs:CreateLogGroup",\n                "logs:CreateLogStream",\n                "logs:DescribeLogStreams",\n                "logs:PutRetentionPolicy",\n                "logs:PutLogEvents"\n            ],\n            "Resource": "arn:aws:logs:*:*:*"\n        }\n    ]\n}\n')),Object(o.b)("p",{Valign:"center"},Object(o.b)("img",{src:"/img/aws-cloudwatch/fluent-bit-policy-create.png",alt:"policy create"})),Object(o.b)(i.a,{type:"info",mdxType:"Alert"},Object(o.b)("p",null,"You can enforce this policy by cluster if you need, by updating the ",Object(o.b)("inlineCode",{parentName:"p"},"Resource")," content. But we want to keep it simple in this tutorial, so we will apply it to all clusters (so you can reuse the same service account if you want for other clusters).")),Object(o.b)("p",null,"Once done, let's create a user and attach the policy to it:"),Object(o.b)("p",{Valign:"center"},Object(o.b)("img",{src:"/img/aws-cloudwatch/fluent-bit-user-create.png",alt:"User create"})),Object(o.b)("p",{Valign:"center"},Object(o.b)("img",{src:"/img/aws-cloudwatch/fluent-bit-cloudwatch-permissions.png",alt:"User permissions"})),Object(o.b)("p",null,"Finish the user creation and keep credentials for the coming section."),Object(o.b)("h2",{id:"helm"},"Helm"),Object(o.b)("p",null,"We will use ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://artifacthub.io/packages/helm/aws/aws-for-fluent-bit"}),"AWS fluent-bit Helm Chart")," to setup logs streaming and deploy it with Qovery."),Object(o.b)("h3",{id:"add-the-aws-eks-helm-repository"},"Add the AWS EKS helm repository"),Object(o.b)("p",null,"Add the AWS EKS helm repository in your Qovery settings by following ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/using-qovery/configuration/organization/helm-repository/"}),"this documentation")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Repository name: ",Object(o.b)("inlineCode",{parentName:"li"},"eks")),Object(o.b)("li",{parentName:"ul"},"Kind: ",Object(o.b)("inlineCode",{parentName:"li"},"HTTPS")),Object(o.b)("li",{parentName:"ul"},"Repository URL: ",Object(o.b)("inlineCode",{parentName:"li"},"https://aws.github.io/eks-charts"))),Object(o.b)("h3",{id:"create-and-deploy-the-helm-chart-within-qovery"},"Create and deploy the helm chart within Qovery"),Object(o.b)("p",null,"Create a helm service in the Qovery environment of your choice (preferrably within a dedicated Tooling project) by following ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/using-qovery/configuration/helm/"}),"this documentation")," and these values:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"General:",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Application name: ",Object(o.b)("inlineCode",{parentName:"li"},"fluent-bit")),Object(o.b)("li",{parentName:"ul"},"Source:",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Helm source: ",Object(o.b)("inlineCode",{parentName:"li"},"Helm repository")),Object(o.b)("li",{parentName:"ul"},"Repository: ",Object(o.b)("inlineCode",{parentName:"li"},"eks")," (the name given during the AWS EKS helm repository added in the previous step)"),Object(o.b)("li",{parentName:"ul"},"Chart name: ",Object(o.b)("inlineCode",{parentName:"li"},"aws-for-fluent-bit")),Object(o.b)("li",{parentName:"ul"},"Version: ",Object(o.b)("inlineCode",{parentName:"li"},"0.1.21")," (this is the version we used for this setup, update it based on the chosen version)"),Object(o.b)("li",{parentName:"ul"},"Allow cluster-wide resources \u2714\ufe0f"))))),Object(o.b)("li",{parentName:"ul"},"Values",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Values override as file:"),Object(o.b)("li",{parentName:"ul"},"File source: ",Object(o.b)("inlineCode",{parentName:"li"},"Raw YAML")),Object(o.b)("li",{parentName:"ul"},"Raw YAML:")))),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'priorityClassName: system-node-critical\n\ncloudWatch:\n  enabled: true\n  region: "<enter your cluster region>"\n  logGroupName: "/aws/eks/fluentbit-<enter your cluster region>/logs"\n  logRetentionDays: 7\n\nenv:\n  - name: "AWS_ACCESS_KEY_ID"\n    value: qovery.env.AWS_ACCESS_KEY\n  - name: "AWS_SECRET_ACCESS_KEY"\n    value: qovery.env.AWS_SECRET_ACCESS_KEY\n\nfirehose:\n  enabled: false\n\nkinesis:\n  enabled: false\n\nelasticsearch:\n  enabled: false\n')),Object(o.b)("p",null,"You can take a look at additional configuration options on the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://artifacthub.io/packages/helm/aws/aws-for-fluent-bit"}),"AWS provided chart")," "),Object(o.b)("p",null,"Now get to the last step and just ",Object(o.b)("inlineCode",{parentName:"p"},"Create")," the service on Qovery."),Object(o.b)("h3",{id:"store-the-aws-secrets-as-qovery-secrets"},"Store the AWS Secrets as Qovery secrets"),Object(o.b)("p",null,"In the previous step we have assigned the macro ",Object(o.b)("inlineCode",{parentName:"p"},"qovery.env.qovery.env.AWS_ACCESS_KEY")," and ",Object(o.b)("inlineCode",{parentName:"p"},"qovery.env.AWS_SECRET_ACCESS_KEY")," to the AWS secrets. In this step we will create these secrets within the Qovery console."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Open the service overview of the created Datadog service"),Object(o.b)("li",{parentName:"ul"},"Enter the ",Object(o.b)("inlineCode",{parentName:"li"},"Variables")," section"),Object(o.b)("li",{parentName:"ul"},"Add a new Variable with:",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Variable = AWS_SECRET_ACCESS_KEY"),Object(o.b)("li",{parentName:"ul"},"Value = <your_SECRET_ACCESS_KEY>"),Object(o.b)("li",{parentName:"ul"},"Scope = Service (so that it is accessible only to this service)"),Object(o.b)("li",{parentName:"ul"},"Secret variable \u2714\ufe0f"))),Object(o.b)("li",{parentName:"ul"},"Add a new Variable with:",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Variable = AWS_ACCESS_KEY"),Object(o.b)("li",{parentName:"ul"},"Value = <your_ACCESS_KEY>"),Object(o.b)("li",{parentName:"ul"},"Scope = Service (so that it is accessible only to this service)"),Object(o.b)("li",{parentName:"ul"},"Secret variable \u2714\ufe0f")))),Object(o.b)("p",null,"If you need more information on how to manage your environment variables, have a look at ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/using-qovery/configuration/environment-variable/"}),"this documentation")),Object(o.b)("h3",{id:"deploy-your-chart"},"Deploy your chart"),Object(o.b)("p",null,"Open the ",Object(o.b)("inlineCode",{parentName:"p"},"Play")," button and trigger the deployment of your chart."),Object(o.b)("h2",{id:"cloudwatch-usage"},"Cloudwatch usage"),Object(o.b)("p",null,"You can now use Cloudwatch to look at your logs. Connect to Cloudwatch, go into the ",Object(o.b)("inlineCode",{parentName:"p"},"Logs insight")," section, then you can perform queries:"),Object(o.b)("p",{Valign:"center"},Object(o.b)("img",{src:"/img/aws-cloudwatch/cloudwatch-search.png",alt:"cloudwatch search"})),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Select the fluent-bit group of logs"),Object(o.b)("li",{parentName:"ol"},"Create a query (",Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_QuerySyntax.html"}),"syntax examples"),")"),Object(o.b)("li",{parentName:"ol"},"Run your query"),Object(o.b)("li",{parentName:"ol"},"See the result and expand to filter on other elements")))}b.isMDXComponent=!0},475:function(e,t,n){var a;!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var a=arguments[t];if(a){var o=typeof a;if("string"===o||"number"===o)e.push(a);else if(Array.isArray(a)&&a.length){var i=r.apply(null,a);i&&e.push(i)}else if("object"===o)for(var l in a)n.call(a,l)&&a[l]&&e.push(l)}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(a=function(){return r}.apply(t,[]))||(e.exports=a)}()},476:function(e,t,n){"use strict";n(478);var a=n(0),r=n.n(a),o=n(475),i=n.n(o);n(132);t.a=function(e){var t=e.children,n=e.classNames,a=e.fill,o=e.icon,l=e.type,c=null;switch(l){case"danger":c="alert-triangle";break;case"success":c="check-circle";break;case"warning":c="alert-triangle";break;default:c="info"}return r.a.createElement("div",{className:i()(n,"alert","alert--"+l,{"alert--fill":a,"alert--icon":!1!==o}),role:"alert"},!1!==o&&r.a.createElement("i",{className:i()("feather","icon-"+(o||c))}),t)}},477:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),u=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l({},t,{},e)),n},b=function(e){var t=u(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),b=u(n),d=a,m=b["".concat(i,".").concat(d)]||b[d]||p[d]||o;return n?r.a.createElement(m,l({ref:t},s,{components:n})):r.a.createElement(m,l({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},478:function(e,t,n){var a=n(12);a(a.P,"Array",{fill:n(479)}),n(74)("fill")},479:function(e,t,n){"use strict";var a=n(27),r=n(75),o=n(26);e.exports=function(e){for(var t=a(this),n=o(t.length),i=arguments.length,l=r(i>1?arguments[1]:void 0,n),c=i>2?arguments[2]:void 0,s=void 0===c?n:r(c,n);s>l;)t[l++]=e;return t}},480:function(e,t,n){var a=n(28).f,r=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in r||n(10)&&a(r,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(e){return""}}})},481:function(e,t,n){"use strict";n(480);var a=n(0),r=n.n(a),o=n(476);t.a=function(e){var t=e.children,n=e.name;return r.a.createElement(o.a,{type:"info",fill:!0,icon:!1,rounded:!0,className:"list--icons list--icons--arrow list--tight list--indent margin-bottom--lg"},r.a.createElement("p",{class:"text--lg margin-bottom--sm",style:{marginTop:"-0.25em"}},"Before you begin, this ",n||"page"," assumes the following:"),t)}},482:function(e,t,n){"use strict";var a=n(1),r=n(0),o=n.n(r),i=n(39),l=n(486),c=n(20),s=n.n(c);t.a=function(e){var t,n=e.to,c=e.href,u=n||c,b=Object(l.a)(u),p=Object(r.useRef)(!1),d=s.a.canUseIntersectionObserver;return Object(r.useEffect)((function(){return!d&&b&&window.docusaurus.prefetch(u),function(){d&&t&&t.disconnect()}}),[u,d,b]),u&&b?o.a.createElement(i.b,Object(a.a)({},e,{onMouseEnter:function(){p.current||(window.docusaurus.preload(u),p.current=!0)},innerRef:function(e){var n,a;d&&e&&b&&(n=e,a=function(){window.docusaurus.prefetch(u)},(t=new window.IntersectionObserver((function(e){e.forEach((function(e){n===e.target&&(e.isIntersecting||e.intersectionRatio>0)&&(t.unobserve(n),t.disconnect(),a())}))}))).observe(n))},to:u})):o.a.createElement("a",Object(a.a)({},e,{href:u}))}},485:function(e,t,n){"use strict";var a=n(0),r=n.n(a),o=n(482),i=n(475),l=n.n(i);n(134);t.a=function(e){var t=e.children,n=e.className,a=e.badge,i=e.leftIcon,c=e.rightIcon,s=e.size,u=e.target,b=e.to,p=l()("jump-to","jump-to--"+s,n),d=r.a.createElement("div",{className:"jump-to--inner"},r.a.createElement("div",{className:"jump-to--inner-2"},i&&r.a.createElement("div",{className:"jump-to--left"},r.a.createElement("i",{className:"feather icon-"+i})),r.a.createElement("div",{className:"jump-to--main"},a?r.a.createElement("span",{className:"badge badge--primary badge--right"},a):"",t),r.a.createElement("div",{className:"jump-to--right"},r.a.createElement("i",{className:"feather icon-"+(c||"chevron-right")+" arrow"}))));return u?r.a.createElement("a",{href:b,target:u,className:p},d):r.a.createElement(o.a,{to:b,className:p},d)}},486:function(e,t,n){"use strict";function a(e){return!1===/^(https?:|\/\/)/.test(e)}n.d(t,"a",(function(){return a}))}}]);