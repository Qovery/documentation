---
$schema: "/.meta/.schemas/guides.json"
title: Setting up Cloudflare and Custom Domain on Qovery
description: Using Cloudflare for applications deployed on Qovery
author_github: https://github.com/jul-dan
tags: ["type: tutorial", "technology: qovery"]
hide_pagination: true
---
import Alert from '@site/src/components/Alert';
import Assumptions from '@site/src/components/Assumptions';
import Jump from '@site/src/components/Jump';

The guide assumes that you have an application up and running on Qovery. We'll go through the process of adding a new Custom Domain to the application and use Cloudflare as the domain provider. We also assume that you own a custom domain on Cloudflare (or any other domain registrar):

<p align="center">
  <img src="/img/cloudflare/1.png" alt="Cloudflare" />
</p>

## Adding a Custom Domain

First, let's open application settings:

<p align="center">
  <img src="/img/cloudflare/2.png" alt="Cloudflare" />
</p>

Add your Cloudflare managed domain in `Domain` section:

<p align="center">
  <img src="/img/cloudflare/3.png" alt="Cloudflare" />
</p>

## Cloudflare Configuration

### CNAME

To finish the configuration on Cloudfalre, open the DNS Settings:

<p align="center">
  <img src="/img/cloudflare/4.png" alt="Cloudflare" />
</p>

And add a CNAME entry with the value taken from the Qovery Console just like this:

<p align="center">
  <img src="/img/cloudflare/5.png" alt="Cloudflare" />
</p>

You can safely use the `Proxy` mode.

### SSL/TLS

The last step to configure the domain Cloudflare side properly, is to use the `Full` TLS encryption:

<p align="center">
  <img src="/img/cloudflare/6.png" alt="Cloudflare" />
</p>

This is the requirement to make Custom Domain work properly using Cloudflare as the domain provider on Qovery.

### Restrict pods access

In order to restrict the pods access to Cloudflare only, you have two ways to perform it:

#### IP whitelisting

In Qovery it is possible to whitelist IP ranges to your application:
* Go in the advanced settings section:
<p align="center">
  <img src="/img/cloudflare/8.png" alt="Cloudflare" />
</p>
* Get the [Cloudflare ips](https://www.cloudflare.com/ips-v4/)
* Edit the `network.ingress.whitelist_source_range` setting to put the Cloudflare ips separated with a comma:
<p align="center">
  <img src="/img/cloudflare/9.png" alt="Cloudflare" />
</p>
* Save and redeploy your application

#### Cloudflared

You can also install Cloudflared with docker by following this [documentation](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/create-remote-tunnel/)
With this method you don't have to expose publicly your application.

You can run directly the Cloudflared docker container oin your `Qovery` environment.
By creation the following service:

<p align="center">
  <img src="/img/cloudflare/10.png" alt="Cloudflare" />
</p>

Once your tunnel is created and connected, you have to set the public hostname and the related service settings.

<p align="center">
  <img src="/img/cloudflare/11.png" alt="Cloudflare" />
</p>

To get the service name of your application deployed by Qovery, you can get it in your application variables:

<p align="center">
  <img src="/img/cloudflare/12.png" alt="Cloudflare" />
</p>

A Cloudflare helm chart is also available [here](https://github.com/cloudflare/helm-charts)

## Conclusion

After following the steps from above, our application should be accessible using the custom domain we selected:

<p align="center">
  <img src="/img/cloudflare/7.png" alt="Cloudflare" />
</p>

In the guide we went through all the necessary steps to configure Cloudflare and Qovery to make use of your custom domain.
